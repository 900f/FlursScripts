<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flurs Script Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="animated-bg">
        <div class="floating-particles"></div>
    </div>

    <!-- CLEAN NAVBAR - NO DOUBLE TEXT -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#home" class="logo">
                <span class="logo-icon"></span>
                Flurs
            </a>
            <ul class="nav-links" id="nav-links">
                <li><a href="#home" class="nav-link active" data-page="home">Home</a></li>
                <li><a href="#scripts" class="nav-link" data-page="scripts">Scripts</a></li>
            </ul>
            <button class="burger-btn" id="burger-btn" aria-label="Open menu" aria-expanded="false">
                <span class="burger-line"></span>
                <span class="burger-line"></span>
                <span class="burger-line"></span>
            </button>
        </div>
    </nav>

    <!-- Mobile menu overlay -->
    <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>
    <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
            <span class="logo" style="pointer-events:none;">
                <span class="logo-icon"></span>
                Flurs
            </span>
            <button class="mobile-menu-close" id="mobile-menu-close" aria-label="Close menu">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <ul class="mobile-nav-links">
            <li><a href="#home" class="mobile-nav-link active" data-page="home"><i class="fa-solid fa-house"></i> Home</a></li>
            <li><a href="#scripts" class="mobile-nav-link" data-page="scripts"><i class="fa-solid fa-code"></i> Scripts</a></li>
        </ul>
        <div class="mobile-menu-footer">
            <a href="#" id="mobile-discord-btn" class="mobile-social-btn discord"><i class="fa-brands fa-discord"></i> Discord</a>
            <a href="#" id="mobile-tiktok-btn" class="mobile-social-btn tiktok"><i class="fa-brands fa-tiktok"></i> TikTok</a>
        </div>
    </div>

    <div id="image-modal" class="image-modal">
        <div class="modal-overlay"></div>
        <img id="enlarged-image" class="enlarged-image" src="" alt="">
    </div>

    <!-- HOME PAGE -->
    <section id="home-page" class="page active">
        <div class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <div class="hero-badge">
                            <span class="status-dot"></span>
                            Script Hub Active
                        </div>
                        <h1 class="hero-title">
                            <span class="title-line">Flurs Cheating</span>
                            <span class="title-line">Script Hub</span>
                            <span class="title-line gradient-text">For Roblox</span>
                        </h1>
                        <p class="hero-description">
                            Access Roblox cheating scripts to gain an advantage in games. Join our Discord community to share and discover scripts, and follow our TikTok and YouTube for tutorials and updates.
                            <br><br>
                            All scripts have been tested on Potassium.                        </p>
                    </div>
                    <div class="download-section">
                        <div class="preview-container">
                            <img src="./images/Hub.png" alt="Script Preview" class="preview-image">
                            <div class="preview-overlay">
                                <div class="preview-stats">
                                    <div class="stat"><span class="stat-value">Many</span><span class="stat-label">Users</span></div>
                                    <div class="stat"><span class="stat-value">Daily</span><span class="stat-label">Script Shares</span></div>
                                    <div class="stat"><span class="stat-value">5+</span><span class="stat-label">Scripts</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="download-controls">
                            <button class="download-btn" id="download-btn">
                                <span class="btn-content">
                                    <span class="btn-icon"><i class="fa-brands fa-discord"></i></span>
                                    <span class="btn-text">
                                        <span class="btn-title">Join Discord</span>
                                        <span class="btn-subtitle">Free • Connect Now</span>
                                    </span>
                                </span>
                                <span class="btn-progress"></span>
                            </button>
                            <div class="download-options">
                                <button class="option-btn" id="tiktok-btn"><span class="option-icon"><i class="fa-brands fa-tiktok"></i></span> Follow on TikTok</button>
                                <button class="option-btn" id="youtube-btn"><span class="option-icon"><i class="fa-brands fa-youtube"></i></span> Subscribe on YouTube</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="features-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Why Choose Flurs?</h2>
                    <p class="section-subtitle">Discover the benefits of our Roblox cheating script community.</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-code"></i></span><h3>Script Library</h3></div>
                        <p>Explore a wide range of Roblox cheating scripts, including aimbots, speed hacks, and more.</p>
                        <div class="feature-metrics"><span class="metric">1000+ Scripts</span><span class="metric">User Tested</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-users"></i></span><h3>Active Community</h3></div>
                        <p>Connect with other users to exchange cheating scripts and strategies for Roblox games.</p>
                        <div class="feature-metrics"><span class="metric">Daily Shares</span><span class="metric">24/7 Support</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-play"></i></span><h3>Tutorials</h3></div>
                        <p>Learn how to use cheating scripts effectively with our detailed guides and video tutorials.</p>
                        <div class="feature-metrics"><span class="metric">Video Tutorials</span><span class="metric">Script Guides</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-star"></i></span><h3>New Scripts</h3></div>
                        <p>Stay updated with the latest cheating scripts through our social media channels and community.</p>
                        <div class="feature-metrics"><span class="metric">Weekly Updates</span><span class="metric">Giveaways</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-comment"></i></span><h3>User Feedback</h3></div>
                        <p>Share your ideas to improve our script library and help shape the community.</p>
                        <div class="feature-metrics"><span class="metric">Open Feedback</span><span class="metric">Community Driven</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-link"></i></span><h3>Multi-Platform Access</h3></div>
                        <p>Join us on Discord, TikTok, and YouTube for a seamless community experience.</p>
                        <div class="feature-metrics"><span class="metric">Cross-Platform</span><span class="metric">Instant Access</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-section">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-item"><span class="stat-number" data-count="1000">0</span><span class="stat-label">Users</span></div>
                    <div class="stat-item"><span class="stat-number" data-count="99">0</span><span class="stat-label">Uptime %</span></div>
                    <div class="stat-item"><span class="stat-number" data-count="50">0</span><span class="stat-label">Daily Scripts</span></div>
                    <div class="stat-item"><span class="stat-number" data-count="24">0</span><span class="stat-label">Support Hours</span></div>
                </div>
            </div>
        </div>
    </section>

    <!-- SCRIPTS PAGE - ALL 11 ORIGINAL SCRIPTS -->
    <section id="scripts-page" class="page">
        <div class="container">
            <div class="page-header">
                <h2 class="page-title">Script Library</h2>
                <p class="page-subtitle">Cheating scripts for Roblox games</p>
            </div>
            <div class="scripts-container">
                <div class="search-bar">
                    <input type="text" id="script-search" placeholder="Search scripts by name or tags...">
                </div>
                <div class="scripts-grid">

                    <div class="script-card" data-name="Soluna Arsenal" data-tags="Soluna Arsenal">
                        <div class="script-image"><img src="./images/Sol.png" alt="Soluna Arsenal Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Soluna Arsenal</h3>
                            <p class="script-description">Some real op bullshit, rapid fire, no reload - recommend using weed client for aimbot and ESP</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/endoverdosing/Soluna-API/refs/heads/main/arsenal.lua",true))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Soluna</span><span class="tag">Arsenal</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Weed Client" data-tags="Arsenal Universal Rivals">
                        <div class="script-image"><img src="./images/Weed.png" alt="Weed Client Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Weed Client</h3>
                            <p class="script-description">Universal Aimbot + ESP.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/ex55/weed-client/refs/heads/main/main.lua"))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Arsenal</span><span class="tag">Universal</span><span class="tag">Rivals</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Argon Cheat - Blade Ball" data-tags="Blade Ball Argon">
                        <div class="script-image"><img src="./images/Argon.png" alt="Argon Cheat Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Argon Cheat - Blade Ball</h3>
                            <p class="script-description">Blade ball cheats for the best gameplay.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/SoyAdriYT/PitbullHubX/refs/heads/main/PitbullHubX.lua", true))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Blade Ball</span><span class="tag">Argon</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Plutonium Cheat" data-tags="Cheat Hub Blade Ball">
                        <div class="script-image"><img src="./images/Plut.png" alt="Plutonium Cheat Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Plutonium Cheat</h3>
                            <p class="script-description">Advanced cheat hub for a variety of games.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/PawsThePaw/Plutonium.AA/main/Plutonium.Loader.lua", true))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Cheat</span><span class="tag">Hub</span><span class="tag">Blade Ball</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Thunder Hub" data-tags="MM2 Murder Mystery">
                        <div class="script-image"><img src="./images/Thunder.png" alt="Thunder Hub Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Thunder Hub</h3>
                            <p class="script-description">Dominate people in Murder Mystery 2.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet('https://raw.githubusercontent.com/Roman34296589/SnapSanixHUB/refs/heads/main/SnapSanixHUB.lua'))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">MM2</span><span class="tag">Murder Mystery</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="TALENTLESS" data-tags="Piano TALENTLESS Auto Play">
                        <div class="script-image"><img src="./images/Piano.png" alt="TALENTLESS Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">TALENTLESS</h3>
                            <p class="script-description">Play roblox digital piano in any game automatically with 400 songs to choose from.</p>
                            <div class="script-code-container">
                                <code class="script-code">pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/hellohellohell012321/TALENTLESS/main/TALENTLESS", true))() end)</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Piano</span><span class="tag">TALENTLESS</span><span class="tag">Auto Play</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Fisch Eclipse" data-tags="Fisch Eclipse Auto Play">
                        <div class="script-image"><img src="./images/Fisch.png" alt="Fish Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Fisch Eclipse</h3>
                            <p class="script-description">Get the best things from the game fish and play automatically.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(Game:HttpGet("https://raw.githubusercontent.com/yolobradda/eclipsefisch/refs/heads/main/eclipsefisch"))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Fisch</span><span class="tag">Eclipse</span><span class="tag">Auto Play</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Strucid Cheats" data-tags="Strucid Hitboxes Cheats">
                        <div class="script-image"><img src="./images/Weed.png" alt="Strucid Cheats Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Strucid Cheats</h3>
                            <p class="script-description">Strucid Cheats.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/10x00/Public-Cracks/main/Apollo%20Hub%20Crack.lua"))();</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Strucid</span><span class="tag">Hitboxes</span><span class="tag">Cheats</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Soluna Rivals" data-tags="Rivals Aimbot Cheats">
                        <div class="script-image"><img src="./images/Rivals.png" alt="Soluna Rivals Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Soluna Rivals</h3>
                            <p class="script-description">Rivals Cheats.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://soluna-script.vercel.app/rivals-modern.lua"))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Rivals</span><span class="tag">Aimbot</span><span class="tag">Cheats</span></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>
    <!-- Hidden uploadscript-page placeholder (routes to admin) -->
    <section id="uploadscript-page" class="page" style="display:none!important;"></section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         ADMIN DASHBOARD
    ════════════════════════════════════════════════════════════════════════ -->
    <section id="admin-page" class="page dash-page-override">

        <!-- LOGIN GATE -->
        <div id="admin-gate" class="dash-gate" style="display:none;">
            <div class="dash-login-card">
                <div class="dash-login-icon"><i class="fa-solid fa-terminal"></i></div>
                <h2>Flurs Admin</h2>
                <p>Authenticate to access the control panel</p>
                <div class="dash-login-field">
                    <i class="fa-solid fa-lock dash-field-icon"></i>
                    <input type="password" id="admin-password-input" placeholder="Enter admin password…" autocomplete="off">
                </div>
                <button id="admin-login-btn" class="dash-login-btn">
                    <i class="fa-solid fa-arrow-right-to-bracket"></i> Unlock Dashboard
                </button>
                <div id="admin-login-error" class="dash-login-error" style="display:none;">
                    <i class="fa-solid fa-triangle-exclamation"></i> Incorrect password
                </div>
            </div>
        </div>

        <!-- DASHBOARD PANEL -->
        <div id="admin-panel" class="dashboard-wrapper" style="display:none;">

            <!-- Sidebar -->
            <aside class="dash-sidebar">
                <div class="dash-sidebar-top">
                    <div class="dash-brand">
                        <div class="dash-brand-icon"><i class="fa-solid fa-shield-halved"></i></div>
                        <div>
                            <div class="dash-brand-name">Flurs Admin</div>
                            <div class="dash-brand-role">Control Panel</div>
                        </div>
                    </div>
                    <nav class="dash-nav">
                        <button class="dash-nav-item active" data-tab="overview"><i class="fa-solid fa-chart-line"></i><span>Overview</span></button>
                        <button class="dash-nav-item" data-tab="public-scripts"><i class="fa-solid fa-scroll"></i><span>Public Scripts</span><span class="dash-nav-badge" id="public-count-badge">0</span></button>
                        <button class="dash-nav-item" data-tab="host-scripts"><i class="fa-solid fa-server"></i><span>Hosted Scripts</span><span class="dash-nav-badge" id="hosted-count-badge">0</span></button>
                        <button class="dash-nav-item" data-tab="add-public"><i class="fa-solid fa-plus-circle"></i><span>Add Public Script</span></button>
                        <button class="dash-nav-item" data-tab="add-hosted"><i class="fa-solid fa-cloud-arrow-up"></i><span>Upload &amp; Host</span></button>
                        <div class="dash-nav-divider"></div>
                        <div class="dash-nav-section-label">Key System</div>
                        <button class="dash-nav-item" data-tab="key-scripts"><i class="fa-solid fa-shield-halved"></i><span>Key Scripts</span><span class="dash-nav-badge" id="keyscript-count-badge">0</span></button>
                        <button class="dash-nav-item" data-tab="keys"><i class="fa-solid fa-key"></i><span>Keys</span><span class="dash-nav-badge" id="keys-count-badge">0</span></button>
                        <button class="dash-nav-item" data-tab="add-key-script"><i class="fa-solid fa-lock"></i><span>Upload Key Script</span></button>
                        <div class="dash-nav-divider"></div>
                        <div class="dash-nav-section-label">Analytics &amp; Security</div>
                        <button class="dash-nav-item" data-tab="analytics"><i class="fa-solid fa-chart-bar"></i><span>Analytics</span></button>
                        <button class="dash-nav-item" data-tab="key-users"><i class="fa-solid fa-user-group"></i><span>Key Users</span></button>
                        <button class="dash-nav-item" data-tab="security-log"><i class="fa-solid fa-shield-virus"></i><span>Security Log</span><span class="dash-nav-badge" id="sec-log-badge" style="background:#ef4444;">0</span></button>
                    </nav>
                </div>
                <div class="dash-sidebar-bottom">
                    <button id="dash-logout-btn" class="dash-logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
                </div>
            </aside>

            <!-- Main content -->
            <main class="dash-main">
                <header class="dash-topbar">
                    <div class="dash-topbar-left">
                        <div class="dash-breadcrumb">
                            <span class="dash-bc-root">Dashboard</span>
                            <i class="fa-solid fa-chevron-right dash-bc-sep"></i>
                            <span class="dash-bc-current" id="dash-bc-current">Overview</span>
                        </div>
                    </div>
                    <div class="dash-topbar-right">
                        <div class="dash-topbar-time" id="dash-clock"></div>
                        <a href="#home" class="dash-exit-btn"><i class="fa-solid fa-arrow-up-right-from-square"></i> View Site</a>
                    </div>
                </header>

                <!-- ── OVERVIEW ── -->
                <div class="dash-tab active" id="tab-overview">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Overview</h1><p class="dash-tab-subtitle">Your hub at a glance</p></div>
                    <div class="dash-stat-grid">
                        <div class="dash-stat-card" style="--card-accent:#7c6dfa;"><div class="dash-stat-icon"><i class="fa-solid fa-scroll"></i></div><div class="dash-stat-body"><div class="dash-stat-value" id="ov-public-count">—</div><div class="dash-stat-label">Public Scripts</div></div></div>
                        <div class="dash-stat-card" style="--card-accent:#34d399;"><div class="dash-stat-icon"><i class="fa-solid fa-server"></i></div><div class="dash-stat-body"><div class="dash-stat-value" id="ov-hosted-count">—</div><div class="dash-stat-label">Hosted Scripts</div></div></div>
                        <div class="dash-stat-card" style="--card-accent:#f59e0b;"><div class="dash-stat-icon"><i class="fa-solid fa-shield-halved"></i></div><div class="dash-stat-body"><div class="dash-stat-value" id="ov-key-count">—</div><div class="dash-stat-label">Key Scripts</div></div></div>
                        <div class="dash-stat-card" style="--card-accent:#ec4899;"><div class="dash-stat-icon"><i class="fa-solid fa-key"></i></div><div class="dash-stat-body"><div class="dash-stat-value" id="ov-keys-count">—</div><div class="dash-stat-label">Active Keys</div></div></div>
                    </div>
                    <div class="dash-two-col">
                        <div class="dash-card">
                            <div class="dash-card-header"><h3><i class="fa-solid fa-server" style="color:var(--green);margin-right:.5rem;"></i>Recent Hosted Scripts</h3><button class="dash-card-action" data-tab="host-scripts">View all</button></div>
                            <div id="ov-hosted-list" class="dash-recent-list"><p class="dash-empty">Loading…</p></div>
                        </div>
                        <div class="dash-card">
                            <div class="dash-card-header"><h3><i class="fa-solid fa-scroll" style="color:var(--accent2);margin-right:.5rem;"></i>Recent Public Scripts</h3><button class="dash-card-action" data-tab="public-scripts">View all</button></div>
                            <div id="ov-public-list" class="dash-recent-list"><p class="dash-empty">Loading…</p></div>
                        </div>
                    </div>
                    <div class="dash-card" style="margin-top:1.5rem;">
                        <div class="dash-card-header"><h3><i class="fa-solid fa-bolt" style="color:#f59e0b;margin-right:.5rem;"></i>Quick Actions</h3></div>
                        <div class="dash-quick-actions">
                            <button class="dash-qa-btn" data-tab="add-public"><i class="fa-solid fa-plus"></i><span>Add Public Script</span></button>
                            <button class="dash-qa-btn" data-tab="add-hosted"><i class="fa-solid fa-cloud-arrow-up"></i><span>Upload &amp; Host Script</span></button>
                            <button class="dash-qa-btn" data-tab="add-key-script"><i class="fa-solid fa-lock"></i><span>Upload Key Script</span></button>
                            <button class="dash-qa-btn" data-tab="keys"><i class="fa-solid fa-key"></i><span>Manage Keys</span></button>
                        </div>
                    </div>
                </div>

                <!-- ── PUBLIC SCRIPTS ── -->
                <div class="dash-tab" id="tab-public-scripts">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Public Scripts</h1><p class="dash-tab-subtitle">Scripts shown on the public Scripts page</p></div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h3><i class="fa-solid fa-list" style="color:var(--accent2);margin-right:.5rem;"></i>All Public Scripts</h3><button class="dash-card-action" data-tab="add-public"><i class="fa-solid fa-plus" style="margin-right:.35rem;"></i>Add New</button></div>
                        <div id="us-scripts-list" class="dash-scripts-list"><p class="dash-empty">Loading…</p></div>
                    </div>
                </div>

                <!-- ── HOSTED SCRIPTS ── -->
                <div class="dash-tab" id="tab-host-scripts">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Hosted Scripts</h1><p class="dash-tab-subtitle">Private Lua — only Roblox executors can fetch them via v2 loader</p></div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h3><i class="fa-solid fa-server" style="color:var(--green);margin-right:.5rem;"></i>Hosted Scripts</h3><button class="dash-card-action" data-tab="add-hosted"><i class="fa-solid fa-plus" style="margin-right:.35rem;"></i>Upload New</button></div>
                        <div id="hosted-scripts-list" class="dash-scripts-list"><p class="dash-empty">No hosted scripts yet.</p></div>
                    </div>
                </div>

                <!-- ── ADD PUBLIC SCRIPT ── -->
                <div class="dash-tab" id="tab-add-public">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Add Public Script</h1><p class="dash-tab-subtitle">Publish a new script card to the public Scripts page</p></div>
                    <div class="dash-form-card">
                        <div class="dash-form-grid">
                            <div class="dash-form-group"><label class="dash-label">Script Name</label><input type="text" id="us-name" placeholder="e.g. Soluna Arsenal" class="dash-input"></div>
                            <div class="dash-form-group"><label class="dash-label">Tags <span class="dash-hint">comma separated</span></label><input type="text" id="us-tags" placeholder="Arsenal, Aimbot" class="dash-input"></div>
                        </div>
                        <div class="dash-form-group"><label class="dash-label">Description</label><input type="text" id="us-description" placeholder="Short description" class="dash-input"></div>
                        <div class="dash-form-group"><label class="dash-label">Loadstring</label><textarea id="us-loadstring" class="dash-textarea" style="min-height:90px;" placeholder="loadstring(game:HttpGet(&quot;...&quot;))()"></textarea></div>
                        <div class="dash-form-group">
                            <label class="dash-label">Script Image <span class="dash-hint">JPG or PNG</span></label>
                            <div class="dash-upload-area" id="upload-image-area" style="position:relative;cursor:pointer;">
                                <i class="fa-solid fa-image"></i><p>Click to choose or drag &amp; drop</p>
                                <input type="file" id="us-image" accept="image/*" style="position:absolute;inset:0;opacity:0;cursor:pointer;">
                            </div>
                            <div id="image-preview-wrap" style="display:none;margin-top:.75rem;position:relative;">
                                <img id="us-image-preview" style="width:100%;border-radius:10px;border:1px solid var(--border);max-height:200px;object-fit:cover;" src="" alt="">
                                <button id="us-image-clear" class="dash-img-clear-btn">✕</button>
                            </div>
                        </div>
                        <div class="dash-form-actions"><button id="us-submit-btn" class="dash-primary-btn"><i class="fa-solid fa-upload"></i> Publish Script</button></div>
                        <div id="us-result" class="dash-success-banner" style="display:none;"><i class="fa-solid fa-check-circle"></i> Script published!</div>
                    </div>
                </div>

                <!-- ── UPLOAD & HOST ── -->
                <div class="dash-tab" id="tab-add-hosted">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Upload &amp; Host Script</h1><p class="dash-tab-subtitle">Host raw Lua — only Roblox executors can fetch it (no key required)</p></div>
                    <div class="dash-form-card">
                        <div class="dash-form-group"><label class="dash-label">Script Label <span class="dash-hint">only visible to you</span></label><input type="text" id="upload-label" placeholder="e.g. My Rivals Script v2" class="dash-input"></div>
                        <div class="dash-form-group"><label class="dash-label">Lua Script Content</label><textarea id="upload-content" class="dash-textarea" style="min-height:260px;font-family:'Courier New',monospace;" placeholder="-- paste your Lua script here"></textarea></div>
                        <div class="dash-form-actions"><button id="upload-script-btn" class="dash-primary-btn"><i class="fa-solid fa-cloud-arrow-up"></i> Generate &amp; Save</button></div>
                        <div id="upload-result" class="dash-result-block" style="display:none;">
                            <div class="dash-result-row"><span class="dash-result-label">Raw URL</span><div class="script-code-container"><code class="script-code" id="upload-result-url"></code><button class="copy-btn" id="upload-copy-btn">Copy</button></div></div>
                            <div class="dash-result-row" style="margin-top:.75rem;"><span class="dash-result-label">Loadstring</span><div class="script-code-container"><code class="script-code" id="upload-result-loadstring"></code><button class="copy-btn" id="upload-copy-ls-btn">Copy</button></div></div>
                            <div class="dash-security-note"><i class="fa-solid fa-lock"></i> Browsers get <strong>403 Forbidden</strong> — only Roblox executors can fetch the Lua.</div>
                        </div>
                    </div>
                </div>

                <!-- ── EDIT PUBLIC SCRIPT ── -->
                <div class="dash-tab" id="tab-edit-public">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Edit Public Script</h1></div>
                    <div class="dash-form-card">
                        <input type="hidden" id="edit-pub-id">
                        <div class="dash-form-grid">
                            <div class="dash-form-group"><label class="dash-label">Script Name</label><input type="text" id="edit-pub-name" class="dash-input"></div>
                            <div class="dash-form-group"><label class="dash-label">Tags</label><input type="text" id="edit-pub-tags" class="dash-input"></div>
                        </div>
                        <div class="dash-form-group"><label class="dash-label">Description</label><input type="text" id="edit-pub-description" class="dash-input"></div>
                        <div class="dash-form-group"><label class="dash-label">Loadstring</label><textarea id="edit-pub-loadstring" class="dash-textarea" style="min-height:90px;"></textarea></div>
                        <div class="dash-form-group">
                            <label class="dash-label">Image <span class="dash-hint">leave blank to keep existing</span></label>
                            <div id="edit-pub-current-img-wrap" style="margin-bottom:.75rem;display:none;"><img id="edit-pub-current-img" style="width:100%;max-height:180px;object-fit:cover;border-radius:10px;border:1px solid var(--border);" src="" alt=""></div>
                            <div class="dash-upload-area" style="position:relative;cursor:pointer;"><i class="fa-solid fa-image"></i><p>Click to choose new image</p><input type="file" id="edit-pub-image" accept="image/*" style="position:absolute;inset:0;opacity:0;cursor:pointer;"></div>
                        </div>
                        <div class="dash-form-actions" style="gap:.75rem;">
                            <button id="edit-pub-save-btn" class="dash-primary-btn"><i class="fa-solid fa-floppy-disk"></i> Save Changes</button>
                            <button id="edit-pub-cancel-btn" class="dash-primary-btn" style="background:var(--surface2);box-shadow:none;border:1px solid var(--border);"><i class="fa-solid fa-xmark"></i> Cancel</button>
                        </div>
                        <div id="edit-pub-result" class="dash-success-banner" style="display:none;"><i class="fa-solid fa-check-circle"></i> Updated!</div>
                    </div>
                </div>

                <!-- ── EDIT HOSTED SCRIPT ── -->
                <div class="dash-tab" id="tab-edit-hosted">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Edit Hosted Script</h1></div>
                    <div class="dash-form-card">
                        <input type="hidden" id="edit-hosted-hash">
                        <div class="dash-form-group"><label class="dash-label">Label</label><input type="text" id="edit-hosted-label" class="dash-input"></div>
                        <div class="dash-form-group"><label class="dash-label">Lua Content</label><textarea id="edit-hosted-content" class="dash-textarea" style="min-height:320px;font-family:'Courier New',monospace;"></textarea></div>
                        <div class="dash-form-actions" style="gap:.75rem;">
                            <button id="edit-hosted-save-btn" class="dash-primary-btn"><i class="fa-solid fa-floppy-disk"></i> Save Changes</button>
                            <button id="edit-hosted-cancel-btn" class="dash-primary-btn" style="background:var(--surface2);box-shadow:none;border:1px solid var(--border);"><i class="fa-solid fa-xmark"></i> Cancel</button>
                        </div>
                        <div id="edit-hosted-result" class="dash-success-banner" style="display:none;"><i class="fa-solid fa-check-circle"></i> Saved!</div>
                    </div>
                </div>

                <!-- ── KEY SCRIPTS ── -->
                <div class="dash-tab" id="tab-key-scripts">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Key Scripts</h1><p class="dash-tab-subtitle">Protected Lua — users need a valid key to execute</p></div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h3><i class="fa-solid fa-shield-halved" style="color:#f59e0b;margin-right:.5rem;"></i>All Key Scripts</h3><button class="dash-card-action" data-tab="add-key-script"><i class="fa-solid fa-plus" style="margin-right:.35rem;"></i>Upload New</button></div>
                        <div id="key-scripts-list" class="dash-scripts-list"><p class="dash-empty">Loading…</p></div>
                    </div>
                </div>

                <!-- ── UPLOAD KEY SCRIPT ── -->
                <div class="dash-tab" id="tab-add-key-script">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Upload Key Script</h1><p class="dash-tab-subtitle">Protected Lua — requires a key to run</p></div>
                    <div class="dash-form-card">
                        <input type="hidden" id="ks-edit-hash">
                        <div class="dash-form-group"><label class="dash-label">Script Label</label><input type="text" id="ks-label" placeholder="e.g. Premium Rivals Script" class="dash-input"></div>
                        <div class="dash-form-group"><label class="dash-label">Lua Script Content</label><textarea id="ks-content" class="dash-textarea" style="min-height:300px;font-family:'Courier New',monospace;" placeholder="-- paste your key-protected Lua here"></textarea></div>
                        <div class="dash-form-actions" style="gap:.75rem;">
                            <button id="ks-save-btn" class="dash-primary-btn"><i class="fa-solid fa-lock"></i> Save Key Script</button>
                            <button id="ks-cancel-btn" class="dash-primary-btn" style="background:var(--surface2);box-shadow:none;border:1px solid var(--border);display:none;"><i class="fa-solid fa-xmark"></i> Cancel</button>
                        </div>
                        <div id="ks-result" style="display:none;">
                            <div class="dash-success-banner" style="margin-bottom:1rem;"><i class="fa-solid fa-check-circle"></i> Key script saved!</div>
                            <div class="dash-card" style="margin-top:0;">
                                <div class="dash-card-header"><h3>Give users this loadstring</h3></div>
                                <p style="font-size:.82rem;color:var(--muted);margin-bottom:.75rem;">User replaces <code style="color:var(--accent2);">YOUR-KEY</code> with their key.</p>
                                <div class="script-code-container"><code class="script-code" id="ks-loader-snippet" style="white-space:pre;font-size:.78rem;"></code><button class="copy-btn" id="ks-copy-snippet-btn">Copy</button></div>
                                <p style="font-size:.75rem;color:var(--muted);margin-top:.875rem;">Hash: <code id="ks-result-hash" style="color:var(--accent2);font-size:.72rem;"></code></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ── KEYS MANAGER ── -->
                <div class="dash-tab" id="tab-keys">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Keys</h1><p class="dash-tab-subtitle">Create, manage and monitor access keys</p></div>
                    <div class="dash-card" style="margin-bottom:1.5rem;">
                        <div class="dash-card-header"><h3><i class="fa-solid fa-plus" style="color:var(--green);margin-right:.5rem;"></i>Generate New Key</h3></div>
                        <div class="key-create-form">
                            <div class="dash-form-grid" style="margin-bottom:0;">
                                <div class="dash-form-group" style="margin-bottom:0;"><label class="dash-label">Note</label><input type="text" id="key-note" placeholder="Discord user#1234" class="dash-input"></div>
                                <div class="dash-form-group" style="margin-bottom:0;"><label class="dash-label">Linked Script <span class="dash-hint">optional</span></label><select id="key-script-select" class="dash-input dash-select"><option value="">— Any key script —</option></select></div>
                                <div class="dash-form-group" style="margin-bottom:0;"><label class="dash-label">Expires <span class="dash-hint">blank = never</span></label><input type="datetime-local" id="key-expiry" class="dash-input"></div>
                                <div class="dash-form-group" style="margin-bottom:0;"><label class="dash-label">Max Uses <span class="dash-hint">blank = unlimited</span></label><input type="number" id="key-maxuses" min="1" class="dash-input"></div>
                            </div>
                            <div style="margin-top:1rem;"><button id="key-create-btn" class="dash-primary-btn"><i class="fa-solid fa-key"></i> Generate Key</button></div>
                            <div id="key-create-result" class="key-result-box" style="display:none;">
                                <div class="key-result-label">New Key</div>
                                <div class="key-result-value-row"><code id="key-create-value" class="key-code"></code><button class="copy-btn" id="key-copy-btn">Copy</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h3><i class="fa-solid fa-list" style="color:var(--accent2);margin-right:.5rem;"></i>All Keys</h3><div style="display:flex;gap:.5rem;"><input type="text" id="key-search" placeholder="Search…" class="dash-input" style="padding:.35rem .75rem;font-size:.85rem;width:180px;"><button class="dash-card-action" id="keys-refresh-btn"><i class="fa-solid fa-rotate-right"></i></button></div></div>
                        <div id="keys-list" class="dash-scripts-list"><p class="dash-empty">Loading…</p></div>
                    </div>
                </div>

                <!-- ── ANALYTICS ── -->
                <div class="dash-tab" id="tab-analytics">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Analytics</h1><p class="dash-tab-subtitle">Usage stats for hosted and key scripts</p></div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h3><i class="fa-solid fa-chart-bar" style="color:var(--accent2);margin-right:.5rem;"></i>Per-Script Usage</h3><button class="dash-card-action" id="analytics-refresh-btn"><i class="fa-solid fa-rotate-right"></i> Refresh</button></div>
                        <div id="analytics-list" class="dash-scripts-list"><p class="dash-empty">Loading…</p></div>
                    </div>
                    <div class="dash-card" id="analytics-detail-card" style="margin-top:1.5rem;display:none;">
                        <div class="dash-card-header"><h3>Recent Executions — <span id="analytics-detail-label"></span></h3><button class="dash-card-action" id="analytics-detail-close">Close</button></div>
                        <div id="analytics-detail-list" class="dash-scripts-list"></div>
                    </div>
                </div>

                <!-- ── KEY USERS ── -->
                <div class="dash-tab" id="tab-key-users">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Key Users</h1></div>
                    <div class="dash-card" style="margin-bottom:1.5rem;">
                        <div class="dash-card-header"><h3>Look Up Key</h3></div>
                        <div style="display:flex;gap:.75rem;flex-wrap:wrap;">
                            <input type="text" id="key-user-search" placeholder="Search by note, key, or username…" class="dash-input" style="flex:1;min-width:200px;">
                            <button class="dash-primary-btn" id="key-user-search-btn" style="padding:.55rem 1.2rem;"><i class="fa-solid fa-search"></i> Search</button>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h3>All Keys with User Data</h3><button class="dash-card-action" id="key-users-refresh-btn"><i class="fa-solid fa-rotate-right"></i></button></div>
                        <div id="key-users-list" class="dash-scripts-list"><p class="dash-empty">Loading…</p></div>
                    </div>
                    <div class="dash-card" id="key-user-detail-card" style="margin-top:1.5rem;display:none;">
                        <div class="dash-card-header"><h3>Usage Log — <span id="key-user-detail-note"></span></h3><button class="dash-card-action" id="key-user-detail-close">Close</button></div>
                        <div id="key-user-detail-list" class="dash-scripts-list"></div>
                    </div>
                </div>

                <!-- ── SECURITY LOG ── -->
                <div class="dash-tab" id="tab-security-log">
                    <div class="dash-tab-header"><h1 class="dash-tab-title">Security Log</h1></div>
                    <div class="dash-stat-grid" id="seclog-stats-grid" style="margin-bottom:1.5rem;"></div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><i class="fa-solid fa-shield-virus" style="color:#ef4444;margin-right:.5rem;"></i>Security Events</h3>
                            <div style="display:flex;gap:.5rem;">
                                <select id="seclog-filter" class="dash-input dash-select" style="padding:.35rem .65rem;font-size:.8rem;">
                                    <option value="">All events</option>
                                    <option value="invalid_key">Invalid key</option>
                                    <option value="hwid_mismatch">HWID mismatch</option>
                                    <option value="blacklisted_key_used">Blacklisted key</option>
                                    <option value="rate_limited">Rate limited</option>
                                    <option value="bad_admin_password">Bad password</option>
                                </select>
                                <button class="dash-card-action" id="seclog-refresh-btn"><i class="fa-solid fa-rotate-right"></i></button>
                            </div>
                        </div>
                        <div id="seclog-list" class="dash-scripts-list"><p class="dash-empty">Loading…</p></div>
                    </div>
                </div>

            </main>
        </div><!-- /admin-panel -->
    </section><!-- /admin-page -->

    <script src="script.js"></script>

    <script>
    /* ═══════════════════════════════════════════════════════════════════════════
       FLURS ADMIN DASHBOARD — self-contained, uses helpers from script.js
    ═══════════════════════════════════════════════════════════════════════════ */
    (function () {
        'use strict';

        // Wait for script.js to define helpers
        function ready(fn) {
            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
            else fn();
        }

        ready(function () {
            const BASE   = window.flursBase   || 'https://www.flurs.xyz';
            const getPw  = window.flursGetPw  || function() { return localStorage.getItem('flurs_admin_pw') || ''; };
            const getUrl = window.flursGetScriptUrl  || function(h) { return BASE+'/files/v2/loader/'+h+'.lua'; };
            const getLS  = window.flursGetLoadstring || function(h) { return 'loadstring(game:HttpGet("'+BASE+'/files/v2/loader/'+h+'.lua",true))()'; };
            const getKS  = window.flursGetKeySnippet || function(h) { return 'script_key="YOUR-KEY"\nloadstring(game:HttpGet("'+BASE+'/files/v3/loader/'+h+'.lua",true))()'; };
            const notif  = window.flursShowNotif     || function(m,t){ alert(m); };
            const escH   = window.escHtml            || function(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); };

            // ── API helpers ─────────────────────────────────────────────────
            async function apiAdmin(payload) {
                const r = await fetch(BASE+'/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({...payload, password: getPw()}) });
                return r.json();
            }
            async function apiKeys(payload) {
                const r = await fetch(BASE+'/api/keys', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({...payload, password: getPw()}) });
                return r.json();
            }
            async function apiUpload(payload) {
                const r = await fetch(BASE+'/api/uploadscript', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({...payload, password: getPw()}) });
                return r.json();
            }

            // ── Clock ────────────────────────────────────────────────────────
            function updateClock() {
                const el = document.getElementById('dash-clock');
                if (!el) return;
                const n = new Date();
                el.textContent = String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0')+':'+String(n.getSeconds()).padStart(2,'0');
            }
            setInterval(updateClock, 1000); updateClock();

            // ── Tab switching ────────────────────────────────────────────────
            const TAB_LABELS = {
                'overview':'Overview','public-scripts':'Public Scripts','host-scripts':'Hosted Scripts',
                'add-public':'Add Public Script','add-hosted':'Upload & Host','edit-public':'Edit Public Script',
                'edit-hosted':'Edit Hosted Script','key-scripts':'Key Scripts','keys':'Keys',
                'add-key-script':'Upload Key Script','analytics':'Analytics','key-users':'Key Users','security-log':'Security Log'
            };

            function switchTab(name) {
                document.querySelectorAll('.dash-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.dash-nav-item').forEach(n => n.classList.remove('active'));
                const tab = document.getElementById('tab-'+name);
                if (tab) tab.classList.add('active');
                document.querySelectorAll('[data-tab="'+name+'"]').forEach(n => n.classList.add('active'));
                const bc = document.getElementById('dash-bc-current');
                if (bc) bc.textContent = TAB_LABELS[name] || name;
                // Load data for the tab
                if (name === 'overview')      loadOverview();
                if (name === 'public-scripts') loadPublicScripts();
                if (name === 'host-scripts')   loadHostedScripts();
                if (name === 'key-scripts')    loadKeyScripts();
                if (name === 'keys')           loadKeys();
                if (name === 'analytics')      loadAnalytics();
                if (name === 'key-users')      loadKeyUsers();
                if (name === 'security-log')   loadSecurityLog();
            }

            // Wire all [data-tab] buttons
            function wireNav() {
                document.querySelectorAll('[data-tab]').forEach(el => {
                    const clone = el.cloneNode(true);
                    el.parentNode.replaceChild(clone, el);
                });
                document.querySelectorAll('[data-tab]').forEach(el => {
                    el.addEventListener('click', function(e) { e.preventDefault(); switchTab(this.getAttribute('data-tab')); });
                });
            }

            // ── Logout ───────────────────────────────────────────────────────
            document.getElementById('dash-logout-btn')?.addEventListener('click', function() {
                localStorage.removeItem('flurs_admin_pw');
                const gate  = document.getElementById('admin-gate');
                const panel = document.getElementById('admin-panel');
                if (gate)  gate.style.display  = 'flex';
                if (panel) panel.style.display = 'none';
                const pwInput = document.getElementById('admin-password-input');
                if (pwInput) pwInput.value = '';
            });

            // ── Watch for script.js unlocking the panel ──────────────────────
            const adminPanel = document.getElementById('admin-panel');
            let dashboardReady = false;
            if (adminPanel) {
                const obs = new MutationObserver(function() {
                    if (adminPanel.style.display && adminPanel.style.display !== 'none' && !dashboardReady) {
                        dashboardReady = true;
                        initDashboard();
                    }
                });
                obs.observe(adminPanel, { attributes: true, attributeFilter: ['style'] });
                // Also check right now in case already visible
                if (adminPanel.style.display && adminPanel.style.display !== 'none') {
                    dashboardReady = true;
                    initDashboard();
                }
            }

            function initDashboard() {
                wireNav();
                wireUploadHosted();
                wireAddPublic();
                wireEditPublic();
                wireEditHosted();
                wireKeySystem();
                wireAnalyticsUI();
                wireKeyUsersUI();
                wireSecurityLogUI();
                loadOverview();
            }

            // ── Date formatter ────────────────────────────────────────────────
            function fmtDate(ts) {
                if (!ts) return '—';
                return new Date(Number(ts)).toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' });
            }

            // ══════════════════════════════════════════════════════════════════
            // OVERVIEW
            // ══════════════════════════════════════════════════════════════════
            async function loadOverview() {
                const [hostedRes, publicRes, keyScriptsRes, keysRes] = await Promise.all([
                    apiAdmin({ action: 'list' }).catch(() => ({})),
                    apiUpload({ action: 'list' }).catch(() => ({})),
                    apiKeys({ action: 'listscripts' }).catch(() => ({})),
                    apiKeys({ action: 'list' }).catch(() => ({})),
                ]);
                const hosted    = hostedRes.ok ? hostedRes.scripts   : [];
                const publics   = publicRes.ok ? publicRes.scripts    : [];
                const keyScripts= keyScriptsRes.ok ? keyScriptsRes.scripts : [];
                const keys      = keysRes.ok ? keysRes.keys           : [];

                setText('ov-hosted-count', hosted.length);
                setText('ov-public-count', publics.length);
                setText('ov-key-count', keyScripts.length);
                setText('ov-keys-count', keys.length);
                setBadge('hosted-count-badge', hosted.length);
                setBadge('public-count-badge', publics.length);
                setBadge('keyscript-count-badge', keyScripts.length);
                setBadge('keys-count-badge', keys.length);

                const hostedList = document.getElementById('ov-hosted-list');
                if (hostedList) {
                    if (!hosted.length) { hostedList.innerHTML = '<p class="dash-empty">None yet.</p>'; }
                    else { hostedList.innerHTML = hosted.slice(0,5).map(s => `<div class="dash-recent-item"><i class="fa-solid fa-server" style="color:var(--green);margin-right:.5rem;"></i>${escH(s.label||'Unnamed')} <span style="color:var(--muted);font-size:.72rem;margin-left:.4rem;">${s.use_count||0} uses</span></div>`).join(''); }
                }
                const publicList = document.getElementById('ov-public-list');
                if (publicList) {
                    if (!publics.length) { publicList.innerHTML = '<p class="dash-empty">None yet.</p>'; }
                    else { publicList.innerHTML = publics.slice(0,5).map(s => `<div class="dash-recent-item"><i class="fa-solid fa-scroll" style="color:var(--accent2);margin-right:.5rem;"></i>${escH(s.name||'Unnamed')}</div>`).join(''); }
                }
            }

            function setText(id, val) { const el = document.getElementById(id); if (el) el.textContent = val; }
            function setBadge(id, val) { const el = document.getElementById(id); if (el) el.textContent = val; }

            // ══════════════════════════════════════════════════════════════════
            // PUBLIC SCRIPTS TAB
            // ══════════════════════════════════════════════════════════════════
            async function loadPublicScripts() {
                const container = document.getElementById('us-scripts-list');
                if (!container) return;
                container.innerHTML = '<p class="dash-empty">Loading…</p>';
                const data = await apiUpload({ action: 'list' }).catch(() => ({}));
                const scripts = data.ok ? (data.scripts || []) : [];
                setBadge('public-count-badge', scripts.length);

                if (!scripts.length) { container.innerHTML = '<p class="dash-empty">No public scripts yet.</p>'; return; }
                container.innerHTML = scripts.map(s => {
                    const thumb = s.image_data ? `<img src="${escH(s.image_data)}" class="dash-pub-thumb" onerror="this.style.display='none'">` : `<div class="dash-script-row-icon"><i class="fa-solid fa-scroll"></i></div>`;
                    const tags = (s.tags||[]).slice(0,3).map(t => `<span class="tag" style="font-size:.68rem;padding:.12rem .5rem;">${escH(t)}</span>`).join('');
                    return `<div class="dash-script-row">
                        <div class="dash-script-row-left">${thumb}<div class="dash-script-row-info"><div class="dash-script-row-name">${escH(s.name)}</div><div class="dash-script-row-meta">${tags}</div></div></div>
                        <div class="dash-script-row-actions">
                            <button class="dash-icon-btn" data-pub-edit="${escH(s.id)}" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="dash-icon-btn danger" data-pub-del="${escH(s.id)}" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div></div>`;
                }).join('');

                container.querySelectorAll('[data-pub-edit]').forEach(btn => {
                    btn.addEventListener('click', () => openEditPublic(btn.getAttribute('data-pub-edit')));
                });
                container.querySelectorAll('[data-pub-del]').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        if (!confirm('Delete this public script?')) return;
                        const d = await apiUpload({ action: 'delete', id: btn.getAttribute('data-pub-del') }).catch(() => ({}));
                        if (d.ok) { notif('Deleted!','success'); loadPublicScripts(); loadOverview(); if (window._loadDynamicScripts) window._loadDynamicScripts(); }
                        else notif('Delete failed: '+(d.error||'unknown'),'error');
                    });
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // HOSTED SCRIPTS TAB
            // ══════════════════════════════════════════════════════════════════
            let _hostedCache = [];

            async function loadHostedScripts() {
                const container = document.getElementById('hosted-scripts-list');
                if (!container) return;
                container.innerHTML = '<p class="dash-empty">Loading…</p>';
                const data = await apiAdmin({ action: 'list' }).catch(() => ({}));
                const scripts = data.ok ? (data.scripts || []) : [];
                _hostedCache = scripts;
                setBadge('hosted-count-badge', scripts.length);

                if (!scripts.length) { container.innerHTML = '<p class="dash-empty">No hosted scripts yet.</p>'; return; }
                container.innerHTML = scripts.map((s, i) => `
                    <div class="dash-script-row" id="hr-${i}">
                        <div class="dash-script-row-left">
                            <div class="dash-script-row-icon" style="background:rgba(52,211,153,.1);border-color:rgba(52,211,153,.2);color:var(--green);"><i class="fa-solid fa-server"></i></div>
                            <div class="dash-script-row-info">
                                <div class="dash-script-row-name">${escH(s.label||'Unnamed')}</div>
                                <div class="dash-script-row-meta" style="font-family:monospace;font-size:.7rem;">${escH(s.hash)}.lua · ${s.use_count||0} uses</div>
                            </div>
                        </div>
                        <div class="dash-script-row-actions">
                            <button class="dash-icon-btn" data-hedit="${i}" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="dash-icon-btn" data-hcopyurl="${i}" title="Copy URL"><i class="fa-solid fa-link"></i></button>
                            <button class="dash-icon-btn" data-hcopyls="${i}" title="Copy Loadstring"><i class="fa-solid fa-code"></i></button>
                            <button class="dash-icon-btn danger" data-hdelete="${i}" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`).join('');

                container.querySelectorAll('[data-hcopyurl]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const s = _hostedCache[+btn.getAttribute('data-hcopyurl')]; if (!s) return;
                        navigator.clipboard.writeText(getUrl(s.hash)).catch(()=>{});
                        flashBtn(btn); notif('URL copied!','success');
                    });
                });
                container.querySelectorAll('[data-hcopyls]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const s = _hostedCache[+btn.getAttribute('data-hcopyls')]; if (!s) return;
                        navigator.clipboard.writeText(getLS(s.hash)).catch(()=>{});
                        flashBtn(btn); notif('Loadstring copied!','success');
                    });
                });
                container.querySelectorAll('[data-hedit]').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const s = _hostedCache[+btn.getAttribute('data-hedit')]; if (!s) return;
                        document.getElementById('edit-hosted-hash').value  = s.hash;
                        document.getElementById('edit-hosted-label').value = s.label||'';
                        document.getElementById('edit-hosted-content').value = '-- loading…';
                        document.getElementById('edit-hosted-result').style.display = 'none';
                        switchTab('edit-hosted');
                        const d = await apiAdmin({ action:'get', hash:s.hash }).catch(()=>({}));
                        document.getElementById('edit-hosted-content').value = d.ok ? (d.content||'') : '-- failed to load';
                    });
                });
                container.querySelectorAll('[data-hdelete]').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const s = _hostedCache[+btn.getAttribute('data-hdelete')]; if (!s) return;
                        if (!confirm('Delete "'+s.label+'"? Cannot be undone.')) return;
                        const d = await apiAdmin({ action:'delete', hash:s.hash }).catch(()=>({}));
                        if (d.ok) { notif('Deleted!','success'); loadHostedScripts(); loadOverview(); }
                        else notif('Delete failed: '+(d.error||'unknown'),'error');
                    });
                });
            }

            function flashBtn(btn) {
                const orig = btn.style.color;
                btn.style.color = 'var(--green)';
                setTimeout(() => { btn.style.color = orig; }, 1000);
            }

            // ══════════════════════════════════════════════════════════════════
            // UPLOAD & HOST
            // ══════════════════════════════════════════════════════════════════
            function wireUploadHosted() {
                const btn = document.getElementById('upload-script-btn');
                if (!btn) return;
                btn.addEventListener('click', async function() {
                    const label   = document.getElementById('upload-label')?.value.trim() || 'Unnamed';
                    const content = document.getElementById('upload-content')?.value || '';
                    if (!content.trim()) { notif('Script content cannot be empty.','error'); return; }

                    btn.disabled = true; btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving…';
                    // Generate random 32-char hex hash
                    const hash = Array.from(crypto.getRandomValues(new Uint8Array(16))).map(b=>b.toString(16).padStart(2,'0')).join('');
                    const data = await apiAdmin({ action:'save', hash, label, content }).catch(()=>({}));
                    btn.disabled = false; btn.innerHTML = '<i class="fa-solid fa-cloud-arrow-up"></i> Generate &amp; Save';

                    if (!data.ok) { notif('Save failed: '+(data.error||'unknown'),'error'); return; }

                    setText('upload-result-url', getUrl(hash));
                    setText('upload-result-loadstring', getLS(hash));
                    document.getElementById('upload-result').style.display = 'block';
                    document.getElementById('upload-label').value  = '';
                    document.getElementById('upload-content').value = '';
                    notif('Script hosted!','success');
                    loadHostedScripts(); loadOverview();
                });

                document.getElementById('upload-copy-btn')?.addEventListener('click', async function() {
                    await navigator.clipboard.writeText(document.getElementById('upload-result-url')?.textContent||'').catch(()=>{});
                    notif('URL copied!','success');
                });
                document.getElementById('upload-copy-ls-btn')?.addEventListener('click', async function() {
                    await navigator.clipboard.writeText(document.getElementById('upload-result-loadstring')?.textContent||'').catch(()=>{});
                    notif('Loadstring copied!','success');
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // ADD PUBLIC SCRIPT
            // ══════════════════════════════════════════════════════════════════
            function wireAddPublic() {
                // Image preview
                const imgInput = document.getElementById('us-image');
                const previewWrap = document.getElementById('image-preview-wrap');
                const previewImg  = document.getElementById('us-image-preview');
                const clearBtn    = document.getElementById('us-image-clear');

                imgInput?.addEventListener('change', function() {
                    if (!this.files[0]) return;
                    const r = new FileReader();
                    r.onload = e => { previewImg.src = e.target.result; previewWrap.style.display='block'; };
                    r.readAsDataURL(this.files[0]);
                });
                clearBtn?.addEventListener('click', function() {
                    if (imgInput) imgInput.value = '';
                    previewWrap.style.display = 'none'; previewImg.src = '';
                });

                const submitBtn = document.getElementById('us-submit-btn');
                if (!submitBtn) return;
                submitBtn.addEventListener('click', async function() {
                    const name        = document.getElementById('us-name')?.value.trim();
                    const description = document.getElementById('us-description')?.value.trim()||'';
                    const loadstring  = document.getElementById('us-loadstring')?.value.trim();
                    const tagsRaw     = document.getElementById('us-tags')?.value.trim()||'';
                    if (!name)       { notif('Name is required.','error'); return; }
                    if (!loadstring) { notif('Loadstring is required.','error'); return; }

                    const tags = tagsRaw ? tagsRaw.split(',').map(t=>t.trim()).filter(Boolean) : [];
                    let imageBase64=null, imageType=null;
                    const f = imgInput?.files[0];
                    if (f) {
                        imageBase64 = await new Promise(res => { const r=new FileReader(); r.onload=e=>res(e.target.result.split(',')[1]); r.readAsDataURL(f); });
                        imageType = f.type;
                    }

                    submitBtn.disabled=true; submitBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Publishing…';
                    const data = await apiUpload({ action:'publish', name, description, loadstring, tags, imageBase64, imageType }).catch(()=>({}));
                    submitBtn.disabled=false; submitBtn.innerHTML='<i class="fa-solid fa-upload"></i> Publish Script';

                    if (data.ok) {
                        const r = document.getElementById('us-result');
                        r.style.display='flex'; setTimeout(()=>{ r.style.display='none'; },2500);
                        document.getElementById('us-name').value=''; document.getElementById('us-description').value='';
                        document.getElementById('us-loadstring').value=''; document.getElementById('us-tags').value='';
                        if (imgInput) imgInput.value=''; previewWrap.style.display='none'; previewImg.src='';
                        notif('Script published!','success');
                        loadPublicScripts(); loadOverview();
                        if (window._loadDynamicScripts) window._loadDynamicScripts();
                    } else {
                        notif('Publish failed: '+(data.error||'unknown'),'error');
                    }
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // EDIT PUBLIC SCRIPT
            // ══════════════════════════════════════════════════════════════════
            async function openEditPublic(id) {
                const data = await apiUpload({ action:'list' }).catch(()=>({}));
                const s = (data.scripts||[]).find(x=>x.id===id);
                if (!s) { notif('Script not found.','error'); return; }

                document.getElementById('edit-pub-id').value          = id;
                document.getElementById('edit-pub-name').value        = s.name||'';
                document.getElementById('edit-pub-tags').value        = (s.tags||[]).join(', ');
                document.getElementById('edit-pub-description').value = s.description||'';
                document.getElementById('edit-pub-loadstring').value  = s.loadstring||'';

                const curWrap = document.getElementById('edit-pub-current-img-wrap');
                const curImg  = document.getElementById('edit-pub-current-img');
                if (s.image_data) { curImg.src=s.image_data; curWrap.style.display='block'; }
                else curWrap.style.display='none';

                const imgInput = document.getElementById('edit-pub-image');
                if (imgInput) imgInput.value='';
                document.getElementById('edit-pub-result').style.display='none';
                switchTab('edit-public');
            }

            function wireEditPublic() {
                document.getElementById('edit-pub-cancel-btn')?.addEventListener('click', ()=>switchTab('public-scripts'));
                document.getElementById('edit-pub-save-btn')?.addEventListener('click', async function() {
                    const id          = document.getElementById('edit-pub-id').value;
                    const name        = document.getElementById('edit-pub-name').value.trim();
                    const description = document.getElementById('edit-pub-description').value.trim();
                    const loadstring  = document.getElementById('edit-pub-loadstring').value.trim();
                    const tagsRaw     = document.getElementById('edit-pub-tags').value.trim();
                    if (!name||!loadstring) { notif('Name and loadstring required.','error'); return; }

                    const tags = tagsRaw ? tagsRaw.split(',').map(t=>t.trim()).filter(Boolean) : [];
                    let imageBase64=null, imageType=null;
                    const imgInput = document.getElementById('edit-pub-image');
                    const f = imgInput?.files[0];
                    if (f) {
                        imageBase64 = await new Promise(res=>{ const r=new FileReader(); r.onload=e=>res(e.target.result.split(',')[1]); r.readAsDataURL(f); });
                        imageType = f.type;
                    }

                    this.disabled=true; this.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Saving…';
                    const data = await apiUpload({ action:'update', id, name, description, loadstring, tags, imageBase64, imageType }).catch(()=>({}));
                    this.disabled=false; this.innerHTML='<i class="fa-solid fa-floppy-disk"></i> Save Changes';

                    if (data.ok) {
                        const r=document.getElementById('edit-pub-result'); r.style.display='flex';
                        setTimeout(()=>{ r.style.display='none'; switchTab('public-scripts'); },1800);
                        loadPublicScripts(); loadOverview();
                        if (window._loadDynamicScripts) window._loadDynamicScripts();
                    } else notif('Save failed: '+(data.error||'unknown'),'error');
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // EDIT HOSTED SCRIPT
            // ══════════════════════════════════════════════════════════════════
            function wireEditHosted() {
                document.getElementById('edit-hosted-cancel-btn')?.addEventListener('click', ()=>switchTab('host-scripts'));
                document.getElementById('edit-hosted-save-btn')?.addEventListener('click', async function() {
                    const hash    = document.getElementById('edit-hosted-hash').value;
                    const label   = document.getElementById('edit-hosted-label').value.trim();
                    const content = document.getElementById('edit-hosted-content').value;
                    if (!hash||!label||!content) { notif('All fields required.','error'); return; }

                    this.disabled=true; this.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Saving…';
                    const data = await apiAdmin({ action:'save', hash, label, content }).catch(()=>({}));
                    this.disabled=false; this.innerHTML='<i class="fa-solid fa-floppy-disk"></i> Save Changes';

                    if (data.ok) {
                        const r=document.getElementById('edit-hosted-result'); r.style.display='flex';
                        setTimeout(()=>{ r.style.display='none'; switchTab('host-scripts'); },1800);
                        loadHostedScripts();
                    } else notif('Save failed: '+(data.error||'unknown'),'error');
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // KEY SCRIPTS
            // ══════════════════════════════════════════════════════════════════
            async function loadKeyScripts() {
                const container = document.getElementById('key-scripts-list');
                if (!container) return;
                container.innerHTML = '<p class="dash-empty">Loading…</p>';
                const data = await apiKeys({ action:'listscripts' }).catch(()=>({}));
                const scripts = data.ok ? (data.scripts||[]) : [];
                setBadge('keyscript-count-badge', scripts.length);

                if (!scripts.length) { container.innerHTML = '<p class="dash-empty">No key scripts yet.</p>'; return; }
                container.innerHTML = scripts.map(s => `
                    <div class="dash-script-row">
                        <div class="dash-script-row-left">
                            <div class="dash-script-row-icon" style="background:rgba(245,158,11,.1);border-color:rgba(245,158,11,.2);color:#f59e0b;"><i class="fa-solid fa-shield-halved"></i></div>
                            <div class="dash-script-row-info">
                                <div class="dash-script-row-name">${escH(s.label||'Unnamed')}</div>
                                <div class="dash-script-row-meta" style="font-family:monospace;font-size:.7rem;">${escH(s.hash)}.lua · ${s.use_count||0} uses</div>
                            </div>
                        </div>
                        <div class="dash-script-row-actions">
                            <button class="dash-icon-btn" data-ks-edit="${escH(s.hash)}" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="dash-icon-btn" data-ks-copy="${escH(s.hash)}" title="Copy Snippet"><i class="fa-solid fa-code"></i></button>
                            <button class="dash-icon-btn danger" data-ks-del="${escH(s.hash)}" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`).join('');

                container.querySelectorAll('[data-ks-copy]').forEach(btn=>{
                    btn.addEventListener('click',()=>{ const h=btn.getAttribute('data-ks-copy'); navigator.clipboard.writeText(getKS(h)).catch(()=>{}); flashBtn(btn); notif('Snippet copied!','success'); });
                });
                container.querySelectorAll('[data-ks-edit]').forEach(btn=>{
                    btn.addEventListener('click', async ()=>{
                        const h=btn.getAttribute('data-ks-edit');
                        const d=await apiKeys({action:'getscript',hash:h}).catch(()=>({}));
                        if (!d.ok) { notif('Could not load script.','error'); return; }
                        document.getElementById('ks-edit-hash').value = h;
                        document.getElementById('ks-label').value     = d.label||'';
                        document.getElementById('ks-content').value   = d.content||'';
                        document.getElementById('ks-result').style.display='none';
                        document.getElementById('ks-cancel-btn').style.display='inline-flex';
                        document.getElementById('ks-save-btn').innerHTML='<i class="fa-solid fa-floppy-disk"></i> Save Changes';
                        switchTab('add-key-script');
                    });
                });
                container.querySelectorAll('[data-ks-del]').forEach(btn=>{
                    btn.addEventListener('click', async ()=>{
                        if (!confirm('Delete this key script? Keys linked to it will stop working.')) return;
                        const d=await apiKeys({action:'deletescript',hash:btn.getAttribute('data-ks-del')}).catch(()=>({}));
                        if (d.ok) { notif('Deleted!','success'); loadKeyScripts(); loadOverview(); }
                        else notif('Delete failed: '+(d.error||'unknown'),'error');
                    });
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // UPLOAD KEY SCRIPT
            // ══════════════════════════════════════════════════════════════════
            function wireKeySystem() {
                const saveBtn   = document.getElementById('ks-save-btn');
                const cancelBtn = document.getElementById('ks-cancel-btn');

                cancelBtn?.addEventListener('click', ()=>{
                    document.getElementById('ks-edit-hash').value='';
                    document.getElementById('ks-label').value='';
                    document.getElementById('ks-content').value='';
                    document.getElementById('ks-result').style.display='none';
                    cancelBtn.style.display='none';
                    saveBtn.innerHTML='<i class="fa-solid fa-lock"></i> Save Key Script';
                    switchTab('key-scripts');
                });

                saveBtn?.addEventListener('click', async function() {
                    const hash    = document.getElementById('ks-edit-hash').value || null;
                    const label   = document.getElementById('ks-label').value.trim();
                    const content = document.getElementById('ks-content').value.trim();
                    if (!label)   { notif('Label is required.','error'); return; }
                    if (!content) { notif('Script content is required.','error'); return; }

                    this.disabled=true; this.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Saving…';
                    const data = await apiKeys({ action:'savescript', hash, label, content }).catch(()=>({}));
                    this.disabled=false;

                    if (data.ok) {
                        const finalHash = data.hash;
                        document.getElementById('ks-edit-hash').value   = finalHash;
                        document.getElementById('ks-result-hash').textContent = finalHash;
                        document.getElementById('ks-loader-snippet').textContent = getKS(finalHash);
                        document.getElementById('ks-result').style.display='block';
                        cancelBtn.style.display='inline-flex';
                        this.innerHTML='<i class="fa-solid fa-floppy-disk"></i> Save Changes';
                        notif('Key script saved!','success');
                        loadKeyScripts(); loadOverview();
                        // Refresh key script dropdown
                        const sel=document.getElementById('key-script-select');
                        if (sel) { sel.innerHTML='<option value="">— Any key script —</option>'; loadKeyScriptOptions(); }
                    } else {
                        notif('Save failed: '+(data.error||'unknown'),'error');
                        this.innerHTML='<i class="fa-solid fa-lock"></i> Save Key Script';
                    }
                });

                document.getElementById('ks-copy-snippet-btn')?.addEventListener('click', function() {
                    const text=document.getElementById('ks-loader-snippet')?.textContent;
                    if (text) navigator.clipboard.writeText(text).catch(()=>{});
                    const orig=this.textContent; this.textContent='Copied!';
                    setTimeout(()=>{this.textContent=orig;},1200);
                });

                // Generate key
                const createBtn=document.getElementById('key-create-btn');
                createBtn?.addEventListener('click', async function() {
                    const note      = document.getElementById('key-note')?.value.trim()||'';
                    const scriptHash= document.getElementById('key-script-select')?.value||null;
                    const expiryVal = document.getElementById('key-expiry')?.value;
                    const maxUsesVal= document.getElementById('key-maxuses')?.value;
                    const expiresAt = expiryVal ? new Date(expiryVal).getTime() : null;
                    const maxUses   = maxUsesVal ? parseInt(maxUsesVal) : null;

                    this.disabled=true; this.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Generating…';
                    const d = await apiKeys({ action:'create', note, scriptHash, expiresAt, maxUses }).catch(()=>({}));
                    this.disabled=false; this.innerHTML='<i class="fa-solid fa-key"></i> Generate Key';

                    if (d.ok) {
                        document.getElementById('key-create-value').textContent=d.key;
                        document.getElementById('key-create-result').style.display='block';
                        document.getElementById('key-note').value='';
                        document.getElementById('key-expiry').value='';
                        document.getElementById('key-maxuses').value='';
                        _allKeys=[]; loadKeys();
                        notif('Key generated!','success');
                    } else notif('Failed: '+(d.error||'unknown'),'error');
                });

                document.getElementById('key-copy-btn')?.addEventListener('click', function() {
                    const val=document.getElementById('key-create-value')?.textContent;
                    if (val) navigator.clipboard.writeText(val).catch(()=>{});
                    const orig=this.textContent; this.textContent='Copied!';
                    setTimeout(()=>{this.textContent=orig;},1200);
                });

                document.getElementById('key-search')?.addEventListener('input', function() { renderKeysFiltered(this.value); });
                document.getElementById('keys-refresh-btn')?.addEventListener('click', ()=>{ _allKeys=[]; loadKeys(); });
            }

            async function loadKeyScriptOptions() {
                const sel=document.getElementById('key-script-select');
                if (!sel) return;
                const d=await apiKeys({action:'listscripts'}).catch(()=>({}));
                const scripts=(d.ok&&d.scripts)||[];
                scripts.forEach(s=>{
                    const o=document.createElement('option'); o.value=s.hash; o.textContent=s.label||s.hash.slice(0,8); sel.appendChild(o);
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // KEYS TAB
            // ══════════════════════════════════════════════════════════════════
            let _allKeys = [];

            async function loadKeys() {
                const container=document.getElementById('keys-list');
                if (!container) return;
                container.innerHTML='<p class="dash-empty">Loading…</p>';
                const data=await apiKeys({action:'list'}).catch(()=>({}));
                _allKeys=(data.ok&&data.keys)||[];
                setBadge('keys-count-badge',_allKeys.length);
                // Load key script options if empty
                const sel=document.getElementById('key-script-select');
                if (sel && sel.options.length<=1) loadKeyScriptOptions();
                renderKeysFiltered('');
            }

            function renderKeysFiltered(q) {
                const container=document.getElementById('keys-list');
                if (!container) return;
                const qlo=(q||'').toLowerCase();
                const filtered=qlo ? _allKeys.filter(k=>(k.note||'').toLowerCase().includes(qlo)||k.id.includes(qlo)) : _allKeys;

                if (!filtered.length) { container.innerHTML='<p class="dash-empty">'+(qlo?'No keys match.':'No keys yet.')+'</p>'; return; }

                container.innerHTML = filtered.map(k => {
                    const now=Date.now();
                    const expired=k.expiresAt&&now>k.expiresAt;
                    const maxed=k.maxUses&&k.useCount>=k.maxUses;
                    const inactive=k.blacklisted||expired||maxed;
                    let badge='<span class="key-badge active">Active</span>';
                    if (k.blacklisted) badge='<span class="key-badge blacklisted">Blacklisted</span>';
                    else if (expired)  badge='<span class="key-badge expired">Expired</span>';
                    else if (maxed)    badge='<span class="key-badge expired">Max Uses</span>';

                    return `<div class="key-row${inactive?' key-row-inactive':''}" id="keyrow-${escH(k.id)}">
                        <div class="key-row-main">
                            <div class="key-row-top"><span class="key-row-value">${escH(k.id)}</span>${badge}</div>
                            <div class="key-row-meta">
                                <span><i class="fa-solid fa-user" style="color:var(--muted);margin-right:.3rem;font-size:.7rem;"></i>${escH(k.note||'—')}</span>
                                <span><i class="fa-solid fa-chart-simple" style="color:var(--muted);margin-right:.3rem;font-size:.7rem;"></i>${k.useCount||0}${k.maxUses?'/'+k.maxUses:''} uses</span>
                                <span><i class="fa-solid fa-fingerprint" style="color:var(--muted);margin-right:.3rem;font-size:.7rem;"></i>${k.hwid?'HWID locked':'Unlocked'}</span>
                                <span><i class="fa-solid fa-clock" style="color:var(--muted);margin-right:.3rem;font-size:.7rem;"></i>${fmtDate(k.expiresAt)}</span>
                            </div>
                        </div>
                        <div class="key-row-actions">
                            <button class="copy-btn" style="font-size:.72rem;" data-kcopy="${escH(k.id)}">Copy</button>
                            <button class="dash-icon-btn" title="${k.blacklisted?'Unrevoke':'Revoke'}" data-krevoke="${escH(k.id)}" data-krevoked="${k.blacklisted}"><i class="fa-solid fa-${k.blacklisted?'rotate-left':'ban'}"></i></button>
                            <button class="dash-icon-btn" title="Reset HWID" data-kreset="${escH(k.id)}"${!k.hwid?' disabled style="opacity:.4;cursor:not-allowed;"':''}><i class="fa-solid fa-fingerprint"></i></button>
                            <button class="dash-icon-btn danger" title="Delete" data-kdel="${escH(k.id)}"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
                }).join('');

                container.querySelectorAll('[data-kcopy]').forEach(btn=>{
                    btn.addEventListener('click',()=>{ navigator.clipboard.writeText(btn.getAttribute('data-kcopy')).catch(()=>{}); const o=btn.textContent; btn.textContent='Copied!'; setTimeout(()=>{btn.textContent=o;},1200); });
                });
                container.querySelectorAll('[data-krevoke]').forEach(btn=>{
                    btn.addEventListener('click', async ()=>{
                        const id=btn.getAttribute('data-krevoke'); const rev=btn.getAttribute('data-krevoked')==='true';
                        const d=await apiKeys({action:rev?'unrevoke':'revoke',id}).catch(()=>({}));
                        if (d.ok) { _allKeys=[]; loadKeys(); } else notif('Failed: '+(d.error||'unknown'),'error');
                    });
                });
                container.querySelectorAll('[data-kreset]').forEach(btn=>{
                    btn.addEventListener('click', async ()=>{
                        if (!confirm('Reset HWID? Next device to use this key will be locked.')) return;
                        const d=await apiKeys({action:'update',id:btn.getAttribute('data-kreset'),resetHwid:true}).catch(()=>({}));
                        if (d.ok) { _allKeys=[]; loadKeys(); } else notif('Failed: '+(d.error||'unknown'),'error');
                    });
                });
                container.querySelectorAll('[data-kdel]').forEach(btn=>{
                    btn.addEventListener('click', async ()=>{
                        if (!confirm('Permanently delete this key?')) return;
                        const d=await apiKeys({action:'delete',id:btn.getAttribute('data-kdel')}).catch(()=>({}));
                        if (d.ok) { _allKeys=[]; loadKeys(); } else notif('Failed: '+(d.error||'unknown'),'error');
                    });
                });
            }

            // ══════════════════════════════════════════════════════════════════
            // ANALYTICS
            // ══════════════════════════════════════════════════════════════════
            function wireAnalyticsUI() {
                document.getElementById('analytics-refresh-btn')?.addEventListener('click', loadAnalytics);
                document.getElementById('analytics-detail-close')?.addEventListener('click', ()=>{ document.getElementById('analytics-detail-card').style.display='none'; });
                loadAnalytics();
            }

            async function loadAnalytics() {
                const list=document.getElementById('analytics-list');
                if (!list) return;
                list.innerHTML='<p class="dash-empty">Loading…</p>';
                const pw=getPw();

                const [hostedRes, keyRes] = await Promise.all([
                    apiAdmin({action:'list'}).catch(()=>({})),
                    apiKeys({action:'scriptanalytics'}).catch(()=>({})),
                ]);

                const hosted  = (hostedRes.ok?hostedRes.scripts:[]).map(s=>({ id:s.hash, label:s.label||'Unnamed', useCount:s.use_count||0, lastUsed:s.last_used, _type:'hosted', usageLog:s.usageLog||[] }));
                const keyScr  = (keyRes.ok?keyRes.scripts:[]).map(s=>({...s, _type:'key'}));
                const all     = [...hosted,...keyScr].sort((a,b)=>(b.useCount||0)-(a.useCount||0));
                const total   = all.reduce((sum,s)=>sum+(s.useCount||0),0);

                if (!all.length) { list.innerHTML='<p class="dash-empty">No script usage yet.</p>'; return; }
                list.innerHTML = all.map(s=>{
                    const bar=total?Math.round((s.useCount/total)*100):0;
                    const isKey=s._type==='key';
                    const col=isKey?'#f59e0b':'var(--accent2)';
                    const icon=isKey?'fa-shield-halved':'fa-server';
                    const badge=isKey?'<span style="font-size:.65rem;background:rgba(245,158,11,.12);color:#f59e0b;padding:.1rem .4rem;border-radius:4px;margin-left:.4rem;">KEY</span>':'';
                    return `<div class="dash-script-row" style="flex-direction:column;gap:.6rem;cursor:pointer;" data-ah="${escH(s.id)}" data-al="${escH(s.label)}" data-at="${escH(s._type)}">
                        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem;">
                            <div style="display:flex;align-items:center;gap:.75rem;">
                                <div class="dash-script-row-icon" style="background:rgba(124,109,250,.1);border-color:rgba(124,109,250,.2);color:${col};"><i class="fa-solid ${icon}"></i></div>
                                <div><div class="dash-script-row-name">${escH(s.label)}${badge}</div><div class="dash-script-row-meta" style="font-size:.7rem;">Last used: ${fmtDate(s.lastUsed)}</div></div>
                            </div>
                            <div style="text-align:right;"><div style="font-size:1.4rem;font-weight:700;color:var(--accent2);">${(s.useCount||0).toLocaleString()}</div><div style="font-size:.7rem;color:var(--muted);">executions</div></div>
                        </div>
                        <div style="background:rgba(124,109,250,.1);border-radius:999px;height:6px;overflow:hidden;"><div style="width:${bar}%;height:100%;background:linear-gradient(90deg,var(--accent2),var(--green));border-radius:999px;transition:width .5s;"></div></div>
                    </div>`;
                }).join('');

                list.querySelectorAll('.dash-script-row').forEach(row=>{
                    row.addEventListener('click', ()=>showAnalyticsDetail(row.dataset.ah, row.dataset.al, row.dataset.at));
                });
            }

            async function showAnalyticsDetail(hash, label, type) {
                const card=document.getElementById('analytics-detail-card');
                const lbl =document.getElementById('analytics-detail-label');
                const lst =document.getElementById('analytics-detail-list');
                if (!card) return;
                card.style.display='block'; lbl.textContent=label; lst.innerHTML='<p class="dash-empty">Loading…</p>';
                card.scrollIntoView({behavior:'smooth'});

                let log=[];
                if (type==='key') {
                    const d=await apiKeys({action:'scriptanalytics',hash}).catch(()=>({}));
                    log=d.analytics?.usageLog||[];
                } else {
                    const d=await apiAdmin({action:'list'}).catch(()=>({}));
                    const found=(d.scripts||[]).find(s=>s.hash===hash);
                    log=found?.usageLog||[];
                }

                if (!log.length) { lst.innerHTML='<p class="dash-empty">No executions yet.</p>'; return; }
                lst.innerHTML=log.map(e=>`
                    <div class="dash-script-row" style="gap:1rem;">
                        <div class="dash-script-row-icon" style="background:rgba(52,211,153,.1);border-color:rgba(52,211,153,.2);color:var(--green);"><i class="fa-solid fa-user"></i></div>
                        <div style="flex:1;min-width:0;"><div class="dash-script-row-name">${escH(e.username||'unknown')}</div><div class="dash-script-row-meta">${new Date(e.ts).toLocaleString()} · IP: ${escH(e.ip||'?')}</div></div>
                    </div>`).join('');
            }

            // ══════════════════════════════════════════════════════════════════
            // KEY USERS
            // ══════════════════════════════════════════════════════════════════
            function wireKeyUsersUI() {
                document.getElementById('key-users-refresh-btn')?.addEventListener('click', ()=>loadKeyUsers());
                document.getElementById('key-user-search-btn')?.addEventListener('click', ()=>loadKeyUsers(document.getElementById('key-user-search')?.value.toLowerCase().trim()));
                document.getElementById('key-user-search')?.addEventListener('keydown', e=>{ if(e.key==='Enter') document.getElementById('key-user-search-btn')?.click(); });
                document.getElementById('key-user-detail-close')?.addEventListener('click', ()=>{ document.getElementById('key-user-detail-card').style.display='none'; });
                loadKeyUsers();
            }

            async function loadKeyUsers(filter) {
                const list=document.getElementById('key-users-list');
                if (!list) return;
                list.innerHTML='<p class="dash-empty">Loading…</p>';
                const data=await apiKeys({action:'list'}).catch(()=>({}));
                if (!data.ok||!data.keys) { list.innerHTML='<p class="dash-empty">Failed to load.</p>'; return; }

                let keys=data.keys.filter(k=>k.useCount>0||k.hwid);
                if (filter) keys=keys.filter(k=>(k.note||'').toLowerCase().includes(filter)||k.id.includes(filter));

                if (!keys.length) { list.innerHTML='<p class="dash-empty">No user data yet.</p>'; return; }
                list.innerHTML=keys.map(k=>`
                    <div class="dash-script-row" style="cursor:pointer;" data-ku-id="${escH(k.id)}" data-ku-note="${escH(k.note||k.id.slice(0,8))}">
                        <div class="dash-script-row-icon"><i class="fa-solid fa-user" style="color:var(--accent2);"></i></div>
                        <div class="dash-script-row-info">
                            <div class="dash-script-row-name">${escH(k.note||'—')}</div>
                            <div class="dash-script-row-meta">${k.useCount||0} uses · HWID: ${k.hwid?'Locked':'None'}</div>
                        </div>
                        <div class="dash-script-row-actions"><button class="dash-icon-btn" data-ku-id="${escH(k.id)}" data-ku-note="${escH(k.note||'')}"><i class="fa-solid fa-eye"></i></button></div>
                    </div>`).join('');

                list.querySelectorAll('[data-ku-id]').forEach(el=>{
                    el.addEventListener('click', ()=>showKeyUserDetail(el.getAttribute('data-ku-id'), el.getAttribute('data-ku-note')));
                });
            }

            async function showKeyUserDetail(id, note) {
                const card=document.getElementById('key-user-detail-card');
                const lbl =document.getElementById('key-user-detail-note');
                const lst =document.getElementById('key-user-detail-list');
                if (!card) return;
                card.style.display='block'; lbl.textContent=note; lst.innerHTML='<p class="dash-empty">Loading…</p>';
                card.scrollIntoView({behavior:'smooth'});

                const data=await apiKeys({action:'keyusers',id}).catch(()=>({}));
                const log=data.usageLog||[];
                if (!log.length) { lst.innerHTML='<p class="dash-empty">No usage yet.</p>'; return; }
                lst.innerHTML=log.map((e,i)=>`
                    <div class="dash-script-row" style="gap:1rem;">
                        <div class="dash-script-row-icon" style="font-weight:700;font-size:.75rem;">#${i+1}</div>
                        <div><div class="dash-script-row-name">${escH(e.username||'unknown')}</div><div class="dash-script-row-meta">${new Date(e.ts).toLocaleString()} · IP: ${escH(e.ip||'?')}</div></div>
                    </div>`).join('');
            }

            // ══════════════════════════════════════════════════════════════════
            // SECURITY LOG
            // ══════════════════════════════════════════════════════════════════
            function wireSecurityLogUI() {
                document.getElementById('seclog-refresh-btn')?.addEventListener('click', loadSecurityLog);
                document.getElementById('seclog-filter')?.addEventListener('change', loadSecurityLog);
                loadSecurityLog();
            }

            async function loadSecurityLog() {
                const list=document.getElementById('seclog-list');
                if (!list) return;
                list.innerHTML='<p class="dash-empty">Loading…</p>';
                const data=await apiKeys({action:'securitylog'}).catch(()=>({}));
                const allEvents=data.events||[];
                const filter=document.getElementById('seclog-filter')?.value||'';
                const events=filter?allEvents.filter(e=>e.type===filter):allEvents;

                setBadge('sec-log-badge', allEvents.length);

                const statsGrid=document.getElementById('seclog-stats-grid');
                if (statsGrid) {
                    const counts={};
                    allEvents.forEach(e=>{ counts[e.type]=(counts[e.type]||0)+1; });
                    statsGrid.innerHTML=[
                        {key:'invalid_key',label:'Invalid Keys',color:'#ef4444',icon:'fa-ban'},
                        {key:'hwid_mismatch',label:'HWID Mismatches',color:'#f97316',icon:'fa-fingerprint'},
                        {key:'bad_admin_password',label:'Bad Passwords',color:'#a855f7',icon:'fa-lock'},
                        {key:'blacklisted_key_used',label:'Blacklisted Keys',color:'#eab308',icon:'fa-skull'},
                    ].map(item=>`<div class="dash-stat-card" style="--card-accent:${item.color};"><div class="dash-stat-icon"><i class="fa-solid ${item.icon}"></i></div><div class="dash-stat-body"><div class="dash-stat-value">${counts[item.key]||0}</div><div class="dash-stat-label">${item.label}</div></div></div>`).join('');
                }

                if (!events.length) { list.innerHTML='<p class="dash-empty">No events'+(filter?' matching filter':'')+'.</p>'; return; }

                const cfg={
                    invalid_key:{color:'#ef4444',icon:'fa-ban',label:'Invalid Key'},
                    hwid_mismatch:{color:'#f97316',icon:'fa-fingerprint',label:'HWID Mismatch'},
                    bad_admin_password:{color:'#a855f7',icon:'fa-lock',label:'Bad Password'},
                    blacklisted_key_used:{color:'#ef4444',icon:'fa-skull',label:'Blacklisted Key'},
                    expired_key_used:{color:'#94a3b8',icon:'fa-clock',label:'Expired Key'},
                    max_uses_reached:{color:'#94a3b8',icon:'fa-chart-simple',label:'Max Uses'},
                    wrong_script_key:{color:'#f97316',icon:'fa-link-slash',label:'Wrong Script'},
                    rate_limited:{color:'#eab308',icon:'fa-gauge-high',label:'Rate Limited'},
                };
                list.innerHTML=events.map(e=>{
                    const c=cfg[e.type]||{color:'#94a3b8',icon:'fa-circle-info',label:e.type};
                    const d=typeof e.details==='string'?JSON.parse(e.details||'{}'):e.details||{};
                    return `<div class="dash-script-row">
                        <div class="dash-script-row-icon" style="background:rgba(255,255,255,.04);border-color:rgba(255,255,255,.08);color:${c.color};"><i class="fa-solid ${c.icon}"></i></div>
                        <div style="flex:1;min-width:0;">
                            <div class="dash-script-row-name" style="color:${c.color};">${c.label}</div>
                            <div class="dash-script-row-meta">${fmtDate(e.ts)} · IP: ${escH(d.ip||'?')}${d.key?' · Key: '+escH(d.key.slice(0,12))+'…':''}</div>
                        </div>
                    </div>`;
                }).join('');
            }

        }); // end ready()
    })();
    </script>

    <!-- Mobile menu -->
    <script>
    (function(){
        const burger  = document.getElementById('burger-btn');
        const close   = document.getElementById('mobile-menu-close');
        const overlay = document.getElementById('mobile-menu-overlay');
        const menu    = document.getElementById('mobile-menu');
        const links   = document.querySelectorAll('.mobile-nav-link');
        function open()  { menu.classList.add('open'); overlay.classList.add('open'); burger.setAttribute('aria-expanded','true');  document.body.style.overflow='hidden'; }
        function shut()  { menu.classList.remove('open'); overlay.classList.remove('open'); burger.setAttribute('aria-expanded','false'); document.body.style.overflow=''; }
        burger?.addEventListener('click', open);
        close?.addEventListener('click', shut);
        overlay?.addEventListener('click', shut);
        links.forEach(l=>l.addEventListener('click', shut));
        const discord=document.getElementById('mobile-discord-btn');
        const tiktok =document.getElementById('mobile-tiktok-btn');
        discord?.addEventListener('click',e=>{e.preventDefault();shut();document.getElementById('download-btn')?.click();});
        tiktok?.addEventListener('click', e=>{e.preventDefault();shut();document.getElementById('tiktok-btn')?.click();});
    })();
    </script>

</body>
</html>

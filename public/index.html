<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flurs Script Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="animated-bg">
        <div class="floating-particles"></div>
    </div>

    <!-- CLEAN NAVBAR - NO DOUBLE TEXT -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#home" class="logo">
                <span class="logo-icon"></span>
                Flurs
            </a>
            <ul class="nav-links" id="nav-links">
                <li><a href="#home" class="nav-link active" data-page="home">Home</a></li>
                <li><a href="#scripts" class="nav-link" data-page="scripts">Scripts</a></li>
            </ul>
            <button class="burger-btn" id="burger-btn" aria-label="Open menu" aria-expanded="false">
                <span class="burger-line"></span>
                <span class="burger-line"></span>
                <span class="burger-line"></span>
            </button>
        </div>
    </nav>

    <!-- Mobile menu overlay -->
    <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>
    <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
            <span class="logo" style="pointer-events:none;">
                <span class="logo-icon"></span>
                Flurs
            </span>
            <button class="mobile-menu-close" id="mobile-menu-close" aria-label="Close menu">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <ul class="mobile-nav-links">
            <li><a href="#home" class="mobile-nav-link active" data-page="home"><i class="fa-solid fa-house"></i> Home</a></li>
            <li><a href="#scripts" class="mobile-nav-link" data-page="scripts"><i class="fa-solid fa-code"></i> Scripts</a></li>
        </ul>
        <div class="mobile-menu-footer">
            <a href="#" id="mobile-discord-btn" class="mobile-social-btn discord"><i class="fa-brands fa-discord"></i> Discord</a>
            <a href="#" id="mobile-tiktok-btn" class="mobile-social-btn tiktok"><i class="fa-brands fa-tiktok"></i> TikTok</a>
        </div>
    </div>

    <div id="image-modal" class="image-modal">
        <div class="modal-overlay"></div>
        <img id="enlarged-image" class="enlarged-image" src="" alt="">
    </div>

    <!-- HOME PAGE -->
    <section id="home-page" class="page active">
        <div class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <div class="hero-badge">
                            <span class="status-dot"></span>
                            Script Hub Active
                        </div>
                        <h1 class="hero-title">
                            <span class="title-line">Flurs Cheating</span>
                            <span class="title-line">Script Hub</span>
                            <span class="title-line gradient-text">For Roblox</span>
                        </h1>
                        <p class="hero-description">
                            Access Roblox cheating scripts to gain an advantage in games. Join our Discord community to share and discover scripts, and follow our TikTok and YouTube for tutorials and updates.
                            <br><br>
                            All scripts have been tested on Potassium.                        </p>
                    </div>
                    <div class="download-section">
                        <div class="preview-container">
                            <img src="./images/Hub.png" alt="Script Preview" class="preview-image">
                            <div class="preview-overlay">
                                <div class="preview-stats">
                                    <div class="stat"><span class="stat-value">Many</span><span class="stat-label">Users</span></div>
                                    <div class="stat"><span class="stat-value">Daily</span><span class="stat-label">Script Shares</span></div>
                                    <div class="stat"><span class="stat-value">5+</span><span class="stat-label">Scripts</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="download-controls">
                            <button class="download-btn" id="download-btn">
                                <span class="btn-content">
                                    <span class="btn-icon"><i class="fa-brands fa-discord"></i></span>
                                    <span class="btn-text">
                                        <span class="btn-title">Join Discord</span>
                                        <span class="btn-subtitle">Free • Connect Now</span>
                                    </span>
                                </span>
                                <span class="btn-progress"></span>
                            </button>
                            <div class="download-options">
                                <button class="option-btn" id="tiktok-btn"><span class="option-icon"><i class="fa-brands fa-tiktok"></i></span> Follow on TikTok</button>
                                <button class="option-btn" id="youtube-btn"><span class="option-icon"><i class="fa-brands fa-youtube"></i></span> Subscribe on YouTube</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="features-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Why Choose Flurs?</h2>
                    <p class="section-subtitle">Discover the benefits of our Roblox cheating script community.</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-code"></i></span><h3>Script Library</h3></div>
                        <p>Explore a wide range of Roblox cheating scripts, including aimbots, speed hacks, and more.</p>
                        <div class="feature-metrics"><span class="metric">1000+ Scripts</span><span class="metric">User Tested</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-users"></i></span><h3>Active Community</h3></div>
                        <p>Connect with other users to exchange cheating scripts and strategies for Roblox games.</p>
                        <div class="feature-metrics"><span class="metric">Daily Shares</span><span class="metric">24/7 Support</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-play"></i></span><h3>Tutorials</h3></div>
                        <p>Learn how to use cheating scripts effectively with our detailed guides and video tutorials.</p>
                        <div class="feature-metrics"><span class="metric">Video Tutorials</span><span class="metric">Script Guides</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-star"></i></span><h3>New Scripts</h3></div>
                        <p>Stay updated with the latest cheating scripts through our social media channels and community.</p>
                        <div class="feature-metrics"><span class="metric">Weekly Updates</span><span class="metric">Giveaways</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-comment"></i></span><h3>User Feedback</h3></div>
                        <p>Share your ideas to improve our script library and help shape the community.</p>
                        <div class="feature-metrics"><span class="metric">Open Feedback</span><span class="metric">Community Driven</span></div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-header"><span class="feature-icon"><i class="fa-solid fa-link"></i></span><h3>Multi-Platform Access</h3></div>
                        <p>Join us on Discord, TikTok, and YouTube for a seamless community experience.</p>
                        <div class="feature-metrics"><span class="metric">Cross-Platform</span><span class="metric">Instant Access</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-section">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-item"><span class="stat-number" data-count="1000">0</span><span class="stat-label">Users</span></div>
                    <div class="stat-item"><span class="stat-number" data-count="99">0</span><span class="stat-label">Uptime %</span></div>
                    <div class="stat-item"><span class="stat-number" data-count="50">0</span><span class="stat-label">Daily Scripts</span></div>
                    <div class="stat-item"><span class="stat-number" data-count="24">0</span><span class="stat-label">Support Hours</span></div>
                </div>
            </div>
        </div>
    </section>

    <!-- SCRIPTS PAGE - ALL 11 ORIGINAL SCRIPTS -->
    <section id="scripts-page" class="page">
        <div class="container">
            <div class="page-header">
                <h2 class="page-title">Script Library</h2>
                <p class="page-subtitle">Cheating scripts for Roblox games</p>
            </div>
            <div class="scripts-container">
                <div class="search-bar">
                    <input type="text" id="script-search" placeholder="Search scripts by name or tags...">
                </div>
                <div class="scripts-grid">

                    <div class="script-card" data-name="Soluna Arsenal" data-tags="Soluna Arsenal">
                        <div class="script-image"><img src="./images/Sol.png" alt="Soluna Arsenal Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Soluna Arsenal</h3>
                            <p class="script-description">Some real op bullshit, rapid fire, no reload - recommend using weed client for aimbot and ESP</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/endoverdosing/Soluna-API/refs/heads/main/arsenal.lua",true))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Soluna</span><span class="tag">Arsenal</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Weed Client" data-tags="Arsenal Universal Rivals">
                        <div class="script-image"><img src="./images/Weed.png" alt="Weed Client Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Weed Client</h3>
                            <p class="script-description">Universal Aimbot + ESP.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/ex55/weed-client/refs/heads/main/main.lua"))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Arsenal</span><span class="tag">Universal</span><span class="tag">Rivals</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Argon Cheat - Blade Ball" data-tags="Blade Ball Argon">
                        <div class="script-image"><img src="./images/Argon.png" alt="Argon Cheat Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Argon Cheat - Blade Ball</h3>
                            <p class="script-description">Blade ball cheats for the best gameplay.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/SoyAdriYT/PitbullHubX/refs/heads/main/PitbullHubX.lua", true))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Blade Ball</span><span class="tag">Argon</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Plutonium Cheat" data-tags="Cheat Hub Blade Ball">
                        <div class="script-image"><img src="./images/Plut.png" alt="Plutonium Cheat Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Plutonium Cheat</h3>
                            <p class="script-description">Advanced cheat hub for a variety of games.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/PawsThePaw/Plutonium.AA/main/Plutonium.Loader.lua", true))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Cheat</span><span class="tag">Hub</span><span class="tag">Blade Ball</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Thunder Hub" data-tags="MM2 Murder Mystery">
                        <div class="script-image"><img src="./images/Thunder.png" alt="Thunder Hub Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Thunder Hub</h3>
                            <p class="script-description">Dominate people in Murder Mystery 2.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet('https://raw.githubusercontent.com/Roman34296589/SnapSanixHUB/refs/heads/main/SnapSanixHUB.lua'))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">MM2</span><span class="tag">Murder Mystery</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="TALENTLESS" data-tags="Piano TALENTLESS Auto Play">
                        <div class="script-image"><img src="./images/Piano.png" alt="TALENTLESS Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">TALENTLESS</h3>
                            <p class="script-description">Play roblox digital piano in any game automatically with 400 songs to choose from.</p>
                            <div class="script-code-container">
                                <code class="script-code">pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/hellohellohell012321/TALENTLESS/main/TALENTLESS", true))() end)</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Piano</span><span class="tag">TALENTLESS</span><span class="tag">Auto Play</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Fisch Eclipse" data-tags="Fisch Eclipse Auto Play">
                        <div class="script-image"><img src="./images/Fisch.png" alt="Fish Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Fisch Eclipse</h3>
                            <p class="script-description">Get the best things from the game fish and play automatically.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(Game:HttpGet("https://raw.githubusercontent.com/yolobradda/eclipsefisch/refs/heads/main/eclipsefisch"))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Fisch</span><span class="tag">Eclipse</span><span class="tag">Auto Play</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Strucid Cheats" data-tags="Strucid Hitboxes Cheats">
                        <div class="script-image"><img src="./images/Weed.png" alt="Strucid Cheats Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Strucid Cheats</h3>
                            <p class="script-description">Strucid Cheats.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://raw.githubusercontent.com/10x00/Public-Cracks/main/Apollo%20Hub%20Crack.lua"))();</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Strucid</span><span class="tag">Hitboxes</span><span class="tag">Cheats</span></div>
                        </div>
                    </div>

                    <div class="script-card" data-name="Soluna Rivals" data-tags="Rivals Aimbot Cheats">
                        <div class="script-image"><img src="./images/Rivals.png" alt="Soluna Rivals Preview"><div class="script-overlay"><span class="script-status">Active</span></div></div>
                        <div class="script-content">
                            <h3 class="script-name">Soluna Rivals</h3>
                            <p class="script-description">Rivals Cheats.</p>
                            <div class="script-code-container">
                                <code class="script-code">loadstring(game:HttpGet("https://soluna-script.vercel.app/rivals-modern.lua"))()</code>
                                <button class="copy-btn">Copy</button>
                            </div>
                            <div class="script-tags"><span class="tag">Rivals</span><span class="tag">Aimbot</span><span class="tag">Cheats</span></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <!-- UPLOAD SCRIPT PAGE - unified into admin dashboard -->
    <section id="uploadscript-page" class="page" style="display:none!important;"></section>

    <!-- UNIFIED ADMIN DASHBOARD (access via #admin or #uploadscript) -->
    <section id="admin-page" class="page dash-page-override">

        <!-- LOGIN GATE -->
        <div id="admin-gate" class="dash-gate" style="display:none;">
            <div class="dash-login-card">
                <div class="dash-login-icon"><i class="fa-solid fa-terminal"></i></div>
                <h2>Flurs Admin</h2>
                <p>Authenticate to access the control panel</p>
                <div class="dash-login-field">
                    <i class="fa-solid fa-lock dash-field-icon"></i>
                    <input type="password" id="admin-password-input" placeholder="Enter admin password…" autocomplete="off">
                </div>
                <button id="admin-login-btn" class="dash-login-btn">
                    <i class="fa-solid fa-arrow-right-to-bracket"></i> Unlock Dashboard
                </button>
                <div id="admin-login-error" class="dash-login-error" style="display:none;">
                    <i class="fa-solid fa-triangle-exclamation"></i> Incorrect password
                </div>
            </div>
        </div>

        <!-- DASHBOARD PANEL (shown after login) -->
        <div id="admin-panel" class="dashboard-wrapper" style="display:none;">

            <!-- Sidebar -->
            <aside class="dash-sidebar">
                <div class="dash-sidebar-top">
                    <div class="dash-brand">
                        <div class="dash-brand-icon"><i class="fa-solid fa-shield-halved"></i></div>
                        <div>
                            <div class="dash-brand-name">Flurs Admin</div>
                            <div class="dash-brand-role">Control Panel</div>
                        </div>
                    </div>
                    <nav class="dash-nav">
                        <button class="dash-nav-item active" data-tab="overview">
                            <i class="fa-solid fa-chart-line"></i>
                            <span>Overview</span>
                        </button>
                        <button class="dash-nav-item" data-tab="public-scripts">
                            <i class="fa-solid fa-scroll"></i>
                            <span>Public Scripts</span>
                            <span class="dash-nav-badge" id="public-count-badge">0</span>
                        </button>
                        <button class="dash-nav-item" data-tab="host-scripts">
                            <i class="fa-solid fa-server"></i>
                            <span>Hosted Scripts</span>
                            <span class="dash-nav-badge" id="hosted-count-badge">0</span>
                        </button>
                        <button class="dash-nav-item" data-tab="add-public">
                            <i class="fa-solid fa-plus-circle"></i>
                            <span>Add Public Script</span>
                        </button>
                        <button class="dash-nav-item" data-tab="add-hosted">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <span>Upload &amp; Host</span>
                        </button>
                        <div class="dash-nav-divider"></div>
                        <div class="dash-nav-section-label">Key System</div>
                        <button class="dash-nav-item" data-tab="key-scripts">
                            <i class="fa-solid fa-shield-halved"></i>
                            <span>Key Scripts</span>
                            <span class="dash-nav-badge" id="keyscript-count-badge">0</span>
                        </button>
                        <button class="dash-nav-item" data-tab="keys">
                            <i class="fa-solid fa-key"></i>
                            <span>Keys</span>
                            <span class="dash-nav-badge" id="keys-count-badge">0</span>
                        </button>
                        <button class="dash-nav-item" data-tab="add-key-script">
                            <i class="fa-solid fa-lock"></i>
                            <span>Upload Key Script</span>
                        </button>
                    </nav>
                </div>
                <div class="dash-sidebar-bottom">
                    <button id="dash-logout-btn" class="dash-logout-btn">
                        <i class="fa-solid fa-right-from-bracket"></i> Logout
                    </button>
                </div>
            </aside>

            <!-- Main content -->
            <main class="dash-main">

                <!-- Top bar -->
                <header class="dash-topbar">
                    <div class="dash-topbar-left">
                        <div class="dash-breadcrumb">
                            <span class="dash-bc-root">Dashboard</span>
                            <i class="fa-solid fa-chevron-right dash-bc-sep"></i>
                            <span class="dash-bc-current" id="dash-bc-current">Overview</span>
                        </div>
                    </div>
                    <div class="dash-topbar-right">
                        <div class="dash-topbar-time" id="dash-clock"></div>
                        <a href="#home" class="dash-exit-btn">
                            <i class="fa-solid fa-arrow-up-right-from-square"></i> View Site
                        </a>
                    </div>
                </header>

                <!-- TAB: OVERVIEW -->
                <div class="dash-tab active" id="tab-overview">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Overview</h1>
                        <p class="dash-tab-subtitle">Your hub at a glance</p>
                    </div>
                    <div class="dash-stat-grid">
                        <div class="dash-stat-card" style="--card-accent:#7c6dfa;">
                            <div class="dash-stat-icon"><i class="fa-solid fa-scroll"></i></div>
                            <div class="dash-stat-body">
                                <div class="dash-stat-value" id="ov-public-count">—</div>
                                <div class="dash-stat-label">Public Scripts</div>
                            </div>
                            <div class="dash-stat-trend"><i class="fa-solid fa-arrow-trend-up"></i></div>
                        </div>
                        <div class="dash-stat-card" style="--card-accent:#34d399;">
                            <div class="dash-stat-icon"><i class="fa-solid fa-server"></i></div>
                            <div class="dash-stat-body">
                                <div class="dash-stat-value" id="ov-hosted-count">—</div>
                                <div class="dash-stat-label">Hosted Scripts</div>
                            </div>
                            <div class="dash-stat-trend"><i class="fa-solid fa-server"></i></div>
                        </div>
                        <div class="dash-stat-card" style="--card-accent:#f59e0b;">
                            <div class="dash-stat-icon"><i class="fa-solid fa-users"></i></div>
                            <div class="dash-stat-body">
                                <div class="dash-stat-value">1,000+</div>
                                <div class="dash-stat-label">Community Members</div>
                            </div>
                            <div class="dash-stat-trend"><i class="fa-solid fa-fire"></i></div>
                        </div>
                        <div class="dash-stat-card" style="--card-accent:#ec4899;">
                            <div class="dash-stat-icon"><i class="fa-solid fa-circle-check"></i></div>
                            <div class="dash-stat-body">
                                <div class="dash-stat-value">99%</div>
                                <div class="dash-stat-label">Uptime</div>
                            </div>
                            <div class="dash-stat-trend"><i class="fa-solid fa-signal"></i></div>
                        </div>
                        <div class="dash-stat-card" style="--card-accent:#a78bfa;">
                            <div class="dash-stat-icon"><i class="fa-solid fa-layer-group"></i></div>
                            <div class="dash-stat-body">
                                <div class="dash-stat-value" id="ov-total-count">—</div>
                                <div class="dash-stat-label">Total Scripts</div>
                            </div>
                            <div class="dash-stat-trend"><i class="fa-solid fa-infinity"></i></div>
                        </div>
                    </div>
                    <div class="dash-two-col">
                        <div class="dash-card">
                            <div class="dash-card-header">
                                <h3><i class="fa-solid fa-scroll" style="color:var(--accent2);margin-right:0.5rem;"></i>Recent Public Scripts</h3>
                                <button class="dash-card-action" data-tab="public-scripts">View all</button>
                            </div>
                            <div id="ov-public-list" class="dash-recent-list">
                                <p class="dash-empty">Loading…</p>
                            </div>
                        </div>
                        <div class="dash-card">
                            <div class="dash-card-header">
                                <h3><i class="fa-solid fa-server" style="color:var(--green);margin-right:0.5rem;"></i>Recent Hosted Scripts</h3>
                                <button class="dash-card-action" data-tab="host-scripts">View all</button>
                            </div>
                            <div id="ov-hosted-list" class="dash-recent-list">
                                <p class="dash-empty">Loading…</p>
                            </div>
                        </div>
                    </div>
                    <div class="dash-card" style="margin-top:1.5rem;">
                        <div class="dash-card-header">
                            <h3><i class="fa-solid fa-bolt" style="color:#f59e0b;margin-right:0.5rem;"></i>Quick Actions</h3>
                        </div>
                        <div class="dash-quick-actions">
                            <button class="dash-qa-btn" data-tab="add-public">
                                <i class="fa-solid fa-plus"></i>
                                <span>Add Public Script</span>
                            </button>
                            <button class="dash-qa-btn" data-tab="add-hosted">
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <span>Upload &amp; Host Script</span>
                            </button>
                            <button class="dash-qa-btn" data-tab="public-scripts">
                                <i class="fa-solid fa-list"></i>
                                <span>Manage Public Scripts</span>
                            </button>
                            <button class="dash-qa-btn" data-tab="host-scripts">
                                <i class="fa-solid fa-database"></i>
                                <span>Manage Hosted Scripts</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- TAB: PUBLIC SCRIPTS -->
                <div class="dash-tab" id="tab-public-scripts">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Public Scripts</h1>
                        <p class="dash-tab-subtitle">Scripts displayed on the public Scripts page</p>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><i class="fa-solid fa-list" style="color:var(--accent2);margin-right:0.5rem;"></i>All Public Scripts</h3>
                            <button class="dash-card-action" data-tab="add-public"><i class="fa-solid fa-plus" style="margin-right:0.35rem;"></i>Add New</button>
                        </div>
                        <div id="us-scripts-list" class="dash-scripts-list">
                            <p class="dash-empty" id="us-no-scripts-msg">Loading scripts…</p>
                        </div>
                    </div>
                </div>

                <!-- TAB: HOSTED SCRIPTS -->
                <div class="dash-tab" id="tab-host-scripts">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Hosted Scripts</h1>
                        <p class="dash-tab-subtitle">Privately hosted Lua — only Roblox executors can fetch them</p>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><i class="fa-solid fa-server" style="color:var(--green);margin-right:0.5rem;"></i>Hosted Scripts</h3>
                            <button class="dash-card-action" data-tab="add-hosted"><i class="fa-solid fa-plus" style="margin-right:0.35rem;"></i>Upload New</button>
                        </div>
                        <div id="hosted-scripts-list" class="dash-scripts-list hosted-scripts-list">
                            <p class="dash-empty" id="no-scripts-msg">No scripts uploaded yet.</p>
                        </div>
                    </div>
                </div>

                <!-- TAB: ADD PUBLIC SCRIPT -->
                <div class="dash-tab" id="tab-add-public">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Add Public Script</h1>
                        <p class="dash-tab-subtitle">Publish a new script card to the public Scripts page</p>
                    </div>
                    <div class="dash-form-card">
                        <div class="dash-form-grid">
                            <div class="dash-form-group">
                                <label class="dash-label">Script Name</label>
                                <input type="text" id="us-name" placeholder="e.g. Soluna Arsenal" class="dash-input admin-input">
                            </div>
                            <div class="dash-form-group">
                                <label class="dash-label">Tags <span class="dash-hint">comma separated</span></label>
                                <input type="text" id="us-tags" placeholder="Arsenal, Aimbot, Universal" class="dash-input admin-input">
                            </div>
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Description</label>
                            <input type="text" id="us-description" placeholder="Short description shown on the card" class="dash-input admin-input">
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Loadstring <span class="dash-hint">full loadstring players copy</span></label>
                            <textarea id="us-loadstring" class="dash-textarea admin-textarea" style="min-height:90px;" placeholder="loadstring(game:HttpGet(&quot;https://...&quot;))()"></textarea>
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Script Image <span class="dash-hint">JPG or PNG thumbnail</span></label>
                            <div class="dash-upload-area upload-image-area" id="upload-image-area">
                                <i class="fa-solid fa-image"></i>
                                <p>Click to choose or drag &amp; drop</p>
                                <input type="file" id="us-image" accept="image/*" style="position:absolute;inset:0;opacity:0;cursor:pointer;">
                            </div>
                            <div id="image-preview-wrap" style="display:none;margin-top:0.75rem;position:relative;">
                                <img id="us-image-preview" style="width:100%;border-radius:10px;border:1px solid var(--border);max-height:200px;object-fit:cover;" src="" alt="Preview">
                                <button id="us-image-clear" class="dash-img-clear-btn">✕</button>
                            </div>
                        </div>
                        <div class="dash-form-actions">
                            <button id="us-submit-btn" class="dash-primary-btn">
                                <i class="fa-solid fa-upload"></i> Publish Script
                            </button>
                        </div>
                        <div id="us-result" class="dash-success-banner" style="display:none;">
                            <i class="fa-solid fa-check-circle"></i> Script published! It now appears on the Scripts page.
                        </div>
                    </div>
                </div>

                <!-- TAB: UPLOAD & HOST -->
                <div class="dash-tab" id="tab-add-hosted">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Upload &amp; Host Script</h1>
                        <p class="dash-tab-subtitle">Host raw Lua — only Roblox executors can fetch it</p>
                    </div>
                    <div class="dash-form-card">
                        <div class="dash-form-group">
                            <label class="dash-label">Script Label <span class="dash-hint">only visible to you</span></label>
                            <input type="text" id="upload-label" placeholder="e.g. My Rivals Script v2" class="dash-input admin-input">
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Lua Script Content</label>
                            <textarea id="upload-content" class="dash-textarea admin-textarea" style="min-height:260px;font-family:'Courier New',monospace;" placeholder="-- paste your Lua script here"></textarea>
                        </div>
                        <div class="dash-form-actions">
                            <button id="upload-script-btn" class="dash-primary-btn">
                                <i class="fa-solid fa-cloud-arrow-up"></i> Generate &amp; Save
                            </button>
                        </div>
                        <div id="upload-result" class="dash-result-block" style="display:none;">
                            <div class="dash-result-row">
                                <span class="dash-result-label">Raw URL</span>
                                <div class="script-code-container">
                                    <code class="script-code" id="upload-result-url"></code>
                                    <button class="copy-btn" id="upload-copy-btn">Copy</button>
                                </div>
                            </div>
                            <div class="dash-result-row" style="margin-top:0.75rem;">
                                <span class="dash-result-label">Loadstring</span>
                                <div class="script-code-container">
                                    <code class="script-code" id="upload-result-loadstring"></code>
                                    <button class="copy-btn" id="upload-copy-ls-btn">Copy</button>
                                </div>
                            </div>
                            <div class="dash-security-note">
                                <i class="fa-solid fa-lock"></i>
                                Browsers get <strong>403 Forbidden</strong> — only Roblox executors (User-Agent check) can fetch the Lua.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: EDIT PUBLIC SCRIPT -->
                <div class="dash-tab" id="tab-edit-public">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Edit Public Script</h1>
                        <p class="dash-tab-subtitle">Update an existing script card on the public Scripts page</p>
                    </div>
                    <div class="dash-form-card">
                        <input type="hidden" id="edit-pub-id">
                        <div class="dash-form-grid">
                            <div class="dash-form-group">
                                <label class="dash-label">Script Name</label>
                                <input type="text" id="edit-pub-name" placeholder="e.g. Soluna Arsenal" class="dash-input admin-input">
                            </div>
                            <div class="dash-form-group">
                                <label class="dash-label">Tags <span class="dash-hint">comma separated</span></label>
                                <input type="text" id="edit-pub-tags" placeholder="Arsenal, Aimbot, Universal" class="dash-input admin-input">
                            </div>
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Description</label>
                            <input type="text" id="edit-pub-description" placeholder="Short description shown on the card" class="dash-input admin-input">
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Loadstring <span class="dash-hint">full loadstring players copy</span></label>
                            <textarea id="edit-pub-loadstring" class="dash-textarea admin-textarea" style="min-height:90px;" placeholder="loadstring(game:HttpGet(&quot;https://...&quot;))()"></textarea>
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Script Image <span class="dash-hint">leave blank to keep existing</span></label>
                            <div id="edit-pub-current-img-wrap" style="margin-bottom:0.75rem;display:none;">
                                <p style="font-size:0.78rem;color:var(--muted);margin-bottom:0.4rem;">Current image:</p>
                                <img id="edit-pub-current-img" style="width:100%;max-height:180px;object-fit:cover;border-radius:10px;border:1px solid var(--border);" src="" alt="Current">
                            </div>
                            <div class="dash-upload-area upload-image-area" id="edit-upload-image-area">
                                <i class="fa-solid fa-image"></i>
                                <p>Click to choose or drag &amp; drop a new image</p>
                                <input type="file" id="edit-pub-image" accept="image/*" style="position:absolute;inset:0;opacity:0;cursor:pointer;">
                            </div>
                            <div id="edit-image-preview-wrap" style="display:none;margin-top:0.75rem;position:relative;">
                                <img id="edit-pub-image-preview" style="width:100%;border-radius:10px;border:1px solid var(--border);max-height:200px;object-fit:cover;" src="" alt="New Preview">
                                <button id="edit-pub-image-clear" class="dash-img-clear-btn">✕</button>
                            </div>
                        </div>
                        <div class="dash-form-actions" style="gap:0.75rem;">
                            <button id="edit-pub-save-btn" class="dash-primary-btn">
                                <i class="fa-solid fa-floppy-disk"></i> Save Changes
                            </button>
                            <button id="edit-pub-cancel-btn" class="dash-primary-btn" style="background:var(--surface2);box-shadow:none;border:1px solid var(--border);">
                                <i class="fa-solid fa-xmark"></i> Cancel
                            </button>
                        </div>
                        <div id="edit-pub-result" class="dash-success-banner" style="display:none;">
                            <i class="fa-solid fa-check-circle"></i> Script updated successfully!
                        </div>
                    </div>
                </div>

                <!-- TAB: EDIT HOSTED SCRIPT -->
                <div class="dash-tab" id="tab-edit-hosted">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Edit Hosted Script</h1>
                        <p class="dash-tab-subtitle">Update the label and Lua content of a hosted script</p>
                    </div>
                    <div class="dash-form-card">
                        <input type="hidden" id="edit-hosted-hash">
                        <div class="dash-form-group">
                            <label class="dash-label">Script Label <span class="dash-hint">only visible to you</span></label>
                            <input type="text" id="edit-hosted-label" placeholder="e.g. My Rivals Script v2" class="dash-input admin-input">
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Lua Script Content</label>
                            <textarea id="edit-hosted-content" class="dash-textarea admin-textarea" style="min-height:320px;font-family:'Courier New',monospace;" placeholder="-- loading script..."></textarea>
                        </div>
                        <div class="dash-form-actions" style="gap:0.75rem;">
                            <button id="edit-hosted-save-btn" class="dash-primary-btn">
                                <i class="fa-solid fa-floppy-disk"></i> Save Changes
                            </button>
                            <button id="edit-hosted-cancel-btn" class="dash-primary-btn" style="background:var(--surface2);box-shadow:none;border:1px solid var(--border);">
                                <i class="fa-solid fa-xmark"></i> Cancel
                            </button>
                        </div>
                        <div id="edit-hosted-result" class="dash-success-banner" style="display:none;">
                            <i class="fa-solid fa-check-circle"></i> Hosted script updated!
                        </div>
                    </div>
                </div>

                <!-- TAB: KEY SCRIPTS -->
                <div class="dash-tab" id="tab-key-scripts">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Key Scripts</h1>
                        <p class="dash-tab-subtitle">Protected Lua scripts — only users with a valid key can run them</p>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><i class="fa-solid fa-shield-halved" style="color:#f59e0b;margin-right:0.5rem;"></i>All Key Scripts</h3>
                            <button class="dash-card-action" data-tab="add-key-script"><i class="fa-solid fa-plus" style="margin-right:0.35rem;"></i>Upload New</button>
                        </div>
                        <div id="key-scripts-list" class="dash-scripts-list">
                            <p class="dash-empty">Loading…</p>
                        </div>
                    </div>
                </div>

                <!-- TAB: KEYS MANAGER -->
                <div class="dash-tab" id="tab-keys">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Keys</h1>
                        <p class="dash-tab-subtitle">Create, manage and monitor access keys</p>
                    </div>

                    <!-- Create key inline form -->
                    <div class="dash-card" style="margin-bottom:1.5rem;">
                        <div class="dash-card-header">
                            <h3><i class="fa-solid fa-plus" style="color:var(--green);margin-right:0.5rem;"></i>Generate New Key</h3>
                        </div>
                        <div class="key-create-form">
                            <div class="dash-form-grid" style="margin-bottom:0;">
                                <div class="dash-form-group" style="margin-bottom:0;">
                                    <label class="dash-label">Note <span class="dash-hint">e.g. user's name</span></label>
                                    <input type="text" id="key-note" placeholder="e.g. Discord user#1234" class="dash-input">
                                </div>
                                <div class="dash-form-group" style="margin-bottom:0;">
                                    <label class="dash-label">Linked Script <span class="dash-hint">optional</span></label>
                                    <select id="key-script-select" class="dash-input dash-select">
                                        <option value="">— Any key script —</option>
                                    </select>
                                </div>
                                <div class="dash-form-group" style="margin-bottom:0;">
                                    <label class="dash-label">Expires <span class="dash-hint">leave blank = never</span></label>
                                    <input type="datetime-local" id="key-expiry" class="dash-input">
                                </div>
                                <div class="dash-form-group" style="margin-bottom:0;">
                                    <label class="dash-label">Max Uses <span class="dash-hint">leave blank = unlimited</span></label>
                                    <input type="number" id="key-maxuses" placeholder="e.g. 1" min="1" class="dash-input">
                                </div>
                            </div>
                            <div style="margin-top:1rem;">
                                <button id="key-create-btn" class="dash-primary-btn">
                                    <i class="fa-solid fa-key"></i> Generate Key
                                </button>
                            </div>
                            <div id="key-create-result" class="key-result-box" style="display:none;">
                                <div class="key-result-label">New Key</div>
                                <div class="key-result-value-row">
                                    <code id="key-create-value" class="key-code"></code>
                                    <button class="copy-btn" id="key-copy-btn">Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Keys list -->
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><i class="fa-solid fa-list" style="color:var(--accent2);margin-right:0.5rem;"></i>All Keys</h3>
                            <div style="display:flex;gap:0.5rem;align-items:center;">
                                <input type="text" id="key-search" placeholder="Search note or key…" class="dash-input" style="width:200px;padding:0.4rem 0.75rem;font-size:0.82rem;">
                                <button class="dash-card-action" id="keys-refresh-btn"><i class="fa-solid fa-rotate-right"></i></button>
                            </div>
                        </div>
                        <div id="keys-list" class="dash-scripts-list">
                            <p class="dash-empty">Loading…</p>
                        </div>
                    </div>
                </div>

                <!-- TAB: UPLOAD KEY SCRIPT -->
                <div class="dash-tab" id="tab-add-key-script">
                    <div class="dash-tab-header">
                        <h1 class="dash-tab-title">Upload Key Script</h1>
                        <p class="dash-tab-subtitle">Upload a protected Lua script — only accessible with a valid key</p>
                    </div>
                    <div class="dash-form-card">
                        <input type="hidden" id="ks-edit-hash">
                        <div class="dash-form-group">
                            <label class="dash-label">Script Label <span class="dash-hint">only visible to you</span></label>
                            <input type="text" id="ks-label" placeholder="e.g. Rivals Pro v3" class="dash-input admin-input">
                        </div>
                        <div class="dash-form-group">
                            <label class="dash-label">Lua Script Content</label>
                            <textarea id="ks-content" class="dash-textarea admin-textarea" style="min-height:300px;font-family:'Courier New',monospace;" placeholder="-- paste your protected Lua here"></textarea>
                        </div>
                        <div class="dash-form-actions" style="gap:0.75rem;">
                            <button id="ks-save-btn" class="dash-primary-btn">
                                <i class="fa-solid fa-lock"></i> Save Key Script
                            </button>
                            <button id="ks-cancel-btn" class="dash-primary-btn" style="background:var(--surface2);box-shadow:none;border:1px solid var(--border);display:none;">
                                <i class="fa-solid fa-xmark"></i> Cancel
                            </button>
                        </div>
                        <div id="ks-result" style="display:none;">
                            <div class="dash-success-banner" style="margin-bottom:1rem;">
                                <i class="fa-solid fa-check-circle"></i> Key script saved!
                            </div>
                            <div class="dash-card" style="margin-top:0;">
                                <div class="dash-card-header" style="padding-bottom:0.75rem;">
                                    <h3 style="font-size:0.9rem;"><i class="fa-solid fa-share-nodes" style="color:var(--green);margin-right:0.4rem;"></i>What users run — give them this</h3>
                                </div>
                                <p style="font-size:0.82rem;color:var(--muted);margin-bottom:0.75rem;">User replaces <code style="color:var(--accent2);background:rgba(124,109,250,0.08);padding:0.1rem 0.4rem;border-radius:4px;">YOUR-KEY</code> with their key. Without a valid key it errors immediately — nothing runs.</p>
                                <div class="script-code-container" style="align-items:center;">
                                    <code class="script-code" id="ks-loader-snippet" style="white-space:pre;font-size:0.78rem;"></code>
                                    <button class="copy-btn" id="ks-copy-snippet-btn">Copy</button>
                                </div>
                                <div style="margin-top:1.25rem;padding:0.875rem 1rem;background:rgba(124,109,250,0.05);border:1px solid rgba(124,109,250,0.15);border-radius:10px;display:flex;gap:0.75rem;align-items:flex-start;">
                                    <i class="fa-solid fa-circle-info" style="color:var(--accent2);margin-top:0.1rem;flex-shrink:0;font-size:0.85rem;"></i>
                                    <p style="font-size:0.78rem;color:var(--muted);margin:0;">Deploy <code style="color:var(--accent2);">api/files/v3/loader.js</code> to your Vercel project. The loader URL above will return the protected script only after the key is validated server-side.</p>
                                </div>
                                <p style="font-size:0.75rem;color:var(--muted);margin-top:0.875rem;"><i class="fa-solid fa-fingerprint" style="color:var(--accent2);margin-right:0.3rem;"></i>Script hash: <code id="ks-result-hash" style="color:var(--accent2);background:rgba(124,109,250,0.08);padding:0.1rem 0.4rem;border-radius:4px;font-size:0.72rem;"></code></p>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>

    </section>

    <script src="script.js"></script>
    <script src="visitor-tracker.js"></script>

    <script>
    /* ── UNIFIED ADMIN DASHBOARD CONTROLLER ──────────────────────────── */
    (function() {

        const HARDCODED_SCRIPTS = [
            { name: 'Soluna Arsenal',           tags: ['Soluna','Arsenal'] },
            { name: 'Weed Client',              tags: ['Arsenal','Universal','Rivals'] },
            { name: 'Argon Cheat - Blade Ball', tags: ['Blade Ball','Argon'] },
            { name: 'Plutonium Cheat',          tags: ['Cheat','Hub','Blade Ball'] },
            { name: 'Thunder Hub',              tags: ['MM2','Murder Mystery'] },
            { name: 'TALENTLESS',               tags: ['Piano','TALENTLESS','Auto Play'] },
            { name: 'Fisch Eclipse',            tags: ['Fisch','Eclipse','Auto Play'] },
            { name: 'Strucid Cheats',           tags: ['Strucid','Hitboxes','Cheats'] },
            { name: 'Soluna Rivals',            tags: ['Rivals','Aimbot','Cheats'] },
        ];
        const HARDCODED_COUNT = HARDCODED_SCRIPTS.length;

        // ── API helpers ───────────────────────────────────────────────────
        function getPw() { return localStorage.getItem('flurs_admin_pw') || ''; }

        async function apiAdmin(payload) {
            const r = await fetch('/api/admin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...payload, password: getPw() }),
            });
            return r.json();
        }

        async function apiUploadscript(payload) {
            const r = await fetch('/api/uploadscript', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });
            return r.json();
        }

        function getScriptUrl(hash) {
            return 'https://api.flurs.xyz/files/v2/loader/' + hash + '.lua';
        }
        function getLoadstring(hash) {
            return 'loadstring(game:HttpGet("' + getScriptUrl(hash) + '", true))()';
        }

        function escHtml(str) {
            return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
        }

        // ── Tab navigation ────────────────────────────────────────────────
        function switchTab(tabName) {
            document.querySelectorAll('.dash-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.dash-nav-item').forEach(n => n.classList.remove('active'));
            const tab = document.getElementById('tab-' + tabName);
            if (tab) tab.classList.add('active');
            document.querySelectorAll('[data-tab="' + tabName + '"]').forEach(n => n.classList.add('active'));
            const labels = { overview:'Overview', 'public-scripts':'Public Scripts', 'host-scripts':'Hosted Scripts', 'add-public':'Add Public Script', 'add-hosted':'Upload & Host', 'edit-public':'Edit Public Script', 'edit-hosted':'Edit Hosted Script', 'key-scripts':'Key Scripts', 'keys':'Keys', 'add-key-script':'Upload Key Script' };
            const bc = document.getElementById('dash-bc-current');
            if (bc) bc.textContent = labels[tabName] || tabName;
            if (tabName === 'overview')        refreshOverview();
            if (tabName === 'public-scripts')  renderPublicScripts();
            if (tabName === 'host-scripts')    renderHostedScripts();
            if (tabName === 'key-scripts')     renderKeyScripts();
            if (tabName === 'keys')            renderKeys();
        }

        // ── Animate count ─────────────────────────────────────────────────
        function animateCount(id, target) {
            const el = document.getElementById(id);
            if (!el) return;
            const start = parseInt(el.textContent) || 0;
            if (start === target) { el.textContent = target; return; }
            const t0 = performance.now();
            (function step(now) {
                const p = Math.min((now - t0) / 600, 1);
                el.textContent = Math.round(start + (target - start) * (1 - Math.pow(1 - p, 3)));
                if (p < 1) requestAnimationFrame(step);
            })(t0);
        }

        // ── Overview ──────────────────────────────────────────────────────
        async function refreshOverview() {
            // Public scripts (no auth)
            const pubData = await apiUploadscript({ action: 'list' }).catch(() => ({}));
            const dynScripts = (pubData.ok && Array.isArray(pubData.scripts)) ? pubData.scripts : [];
            const pubTotal = HARDCODED_COUNT + dynScripts.length;
            animateCount('ov-public-count', pubTotal);
            const pBadge = document.getElementById('public-count-badge');
            if (pBadge) pBadge.textContent = pubTotal;
            const pList = document.getElementById('ov-public-list');
            if (pList) {
                const all = [...HARDCODED_SCRIPTS, ...dynScripts.map(s => ({ name: s.name || 'Unnamed', tags: s.tags || [] }))];
                pList.innerHTML = all.slice(-5).reverse().map(s =>
                    '<div class="dash-recent-item">' +
                    '<div class="dash-recent-dot"></div>' +
                    '<span class="dash-recent-name">' + escHtml(s.name) + '</span>' +
                    '<span class="dash-recent-time" style="color:var(--accent2);font-size:0.7rem;">' + escHtml((s.tags && s.tags[0]) || 'Public') + '</span>' +
                    '</div>'
                ).join('');
            }

            // Hosted scripts (needs auth via /api/admin)
            const hostData = await apiAdmin({ action: 'list' }).catch(() => ({}));
            const hostedScripts = (hostData.ok && Array.isArray(hostData.scripts)) ? hostData.scripts : [];
            const hostedTotal = hostedScripts.length;
            animateCount('ov-hosted-count', hostedTotal);
            animateCount('ov-total-count', pubTotal + hostedTotal);
            const hBadge = document.getElementById('hosted-count-badge');
            if (hBadge) hBadge.textContent = hostedTotal;
            const hList = document.getElementById('ov-hosted-list');
            if (hList) {
                if (!hostedScripts.length) {
                    hList.innerHTML = '<p class="dash-empty">No hosted scripts yet.</p>';
                } else {
                    hList.innerHTML = hostedScripts.slice(-5).reverse().map(s =>
                        '<div class="dash-recent-item">' +
                        '<div class="dash-recent-dot" style="background:var(--green);box-shadow:0 0 6px var(--green);"></div>' +
                        '<span class="dash-recent-name">' + escHtml(s.label || 'Unnamed') + '</span>' +
                        '<span class="dash-recent-time" style="color:var(--green);font-size:0.7rem;">Hosted</span>' +
                        '</div>'
                    ).join('');
                }
            }
        }

        // ── Public Scripts tab ────────────────────────────────────────────
        async function renderPublicScripts() {
            const container = document.getElementById('us-scripts-list');
            if (!container) return;
            container.innerHTML = '<p class="dash-empty">Loading…</p>';

            const data = await apiUploadscript({ action: 'list' }).catch(() => ({}));
            const dynScripts = (data.ok && Array.isArray(data.scripts)) ? data.scripts : [];

            const allPublic = [
                ...HARDCODED_SCRIPTS.map(s => ({ ...s, hardcoded: true })),
                ...dynScripts.map(s => ({ name: s.name || 'Unnamed', tags: Array.isArray(s.tags) ? s.tags : [], hardcoded: false, id: s.id, imageUrl: s.imageUrl }))
            ];

            if (!allPublic.length) { container.innerHTML = '<p class="dash-empty">No scripts yet.</p>'; return; }

            container.innerHTML = allPublic.map(function(s) {
                var thumb = s.imageUrl
                    ? '<img src="' + escHtml(s.imageUrl) + '" class="dash-pub-thumb">'
                    : '<div class="dash-script-row-icon"><i class="fa-solid fa-scroll"></i></div>';
                var tagHtml = s.tags.slice(0, 3).map(function(t) {
                    return '<span class="tag" style="font-size:0.68rem;padding:0.12rem 0.5rem;">' + escHtml(t) + '</span>';
                }).join('');
                var action = s.hardcoded
                    ? '<span style="font-size:0.68rem;color:var(--muted);padding:0 0.4rem;">locked</span>'
                    : '<button class="dash-icon-btn" title="Edit" data-pub-edit-id="' + escHtml(s.id) + '"><i class="fa-solid fa-pen"></i></button>' +
                      '<button class="dash-icon-btn danger" title="Delete" data-pub-id="' + escHtml(s.id) + '"><i class="fa-solid fa-trash"></i></button>';
                return '<div class="dash-script-row">' +
                    '<div class="dash-script-row-left">' + thumb +
                    '<div class="dash-script-row-info">' +
                    '<div class="dash-script-row-name">' + escHtml(s.name) + '</div>' +
                    '<div class="dash-script-row-meta">' + tagHtml + (s.hardcoded ? '<span style="color:var(--muted);font-size:0.7rem;margin-left:0.3rem;">· built-in</span>' : '') + '</div>' +
                    '</div></div>' +
                    '<div class="dash-script-row-actions">' + action + '</div></div>';
            }).join('');

            // Wire delete buttons via event delegation (avoids inline onclick quoting issues)
            container.querySelectorAll('[data-pub-id]').forEach(function(btn) {
                btn.addEventListener('click', function() { window.dashDeletePublic(btn.getAttribute('data-pub-id')); });
            });
            // Wire edit buttons
            container.querySelectorAll('[data-pub-edit-id]').forEach(function(btn) {
                btn.addEventListener('click', function() { window.dashEditPublic(btn.getAttribute('data-pub-edit-id')); });
            });
            // Hide broken images
            container.querySelectorAll('.dash-pub-thumb').forEach(function(img) {
                img.addEventListener('error', function() { img.classList.add('broken'); });
            });
        }

        window.dashDeletePublic = async function(id) {
            if (!confirm('Delete this script from the public page?')) return;
            const data = await apiUploadscript({ action: 'delete', id, password: getPw() }).catch(() => ({}));
            if (data.ok) { renderPublicScripts(); refreshOverview(); }
            else alert('Delete failed: ' + (data.error || 'unknown'));
        };

        window.dashEditPublic = async function(id) {
            const data = await apiUploadscript({ action: 'list' }).catch(() => ({}));
            const dynScripts = (data.ok && Array.isArray(data.scripts)) ? data.scripts : [];
            const s = dynScripts.find(function(x) { return x.id === id; });
            if (!s) { alert('Script not found.'); return; }

            document.getElementById('edit-pub-id').value         = id;
            document.getElementById('edit-pub-name').value       = s.name || '';
            document.getElementById('edit-pub-tags').value       = Array.isArray(s.tags) ? s.tags.join(', ') : '';
            document.getElementById('edit-pub-description').value = s.description || '';
            document.getElementById('edit-pub-loadstring').value  = s.loadstring || '';

            // Show current image
            const curWrap = document.getElementById('edit-pub-current-img-wrap');
            const curImg  = document.getElementById('edit-pub-current-img');
            if (s.imageUrl) { curImg.src = s.imageUrl; curWrap.style.display = 'block'; }
            else { curWrap.style.display = 'none'; }

            // Reset new image picker
            const imgInput = document.getElementById('edit-pub-image');
            if (imgInput) imgInput.value = '';
            document.getElementById('edit-image-preview-wrap').style.display = 'none';
            document.getElementById('edit-pub-result').style.display = 'none';

            switchTab('edit-public');
        };

        // ── Hosted Scripts tab ────────────────────────────────────────────
        // Cache for copy buttons (so index-based copy still works after render)
        let _hostedCache = [];

        async function renderHostedScripts() {
            const container = document.getElementById('hosted-scripts-list');
            if (!container) return;
            container.innerHTML = '<p class="dash-empty">Loading…</p>';

            const data = await apiAdmin({ action: 'list' }).catch(() => ({}));
            const scripts = (data.ok && Array.isArray(data.scripts)) ? data.scripts : [];
            _hostedCache = scripts;

            if (!scripts.length) {
                container.innerHTML = '<p class="dash-empty" id="no-scripts-msg">No hosted scripts yet.</p>';
                return;
            }

            container.innerHTML = scripts.map(function(s, i) {
                return '<div class="dash-script-row" id="hosted-row-' + i + '">' +
                    '<div class="dash-script-row-left">' +
                    '<div class="dash-script-row-icon" style="background:rgba(52,211,153,0.1);border-color:rgba(52,211,153,0.2);color:var(--green);"><i class="fa-solid fa-server"></i></div>' +
                    '<div class="dash-script-row-info">' +
                    '<div class="dash-script-row-name">' + escHtml(s.label || 'Unnamed') + '</div>' +
                    '<div class="dash-script-row-meta" style="font-family:monospace;font-size:0.7rem;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:360px;">' + escHtml(s.hash + '.lua') + '</div>' +
                    '</div></div>' +
                    '<div class="dash-script-row-actions">' +
                    '<button class="dash-icon-btn" title="Edit label" data-hedit="' + i + '"><i class="fa-solid fa-pen"></i></button>' +
                    '<button class="dash-icon-btn" title="Copy URL" data-hcopy-url="' + i + '"><i class="fa-solid fa-link"></i></button>' +
                    '<button class="dash-icon-btn" title="Copy loadstring" data-hcopy-ls="' + i + '"><i class="fa-solid fa-code"></i></button>' +
                    '<button class="dash-icon-btn danger" title="Delete" data-hdelete="' + i + '"><i class="fa-solid fa-trash"></i></button>' +
                    '</div></div>';
            }).join('');

            container.querySelectorAll('[data-hcopy-url]').forEach(function(btn) {
                btn.addEventListener('click', function() { dashCopyHostedUrl(parseInt(btn.getAttribute('data-hcopy-url'))); });
            });
            container.querySelectorAll('[data-hcopy-ls]').forEach(function(btn) {
                btn.addEventListener('click', function() { dashCopyHostedLs(parseInt(btn.getAttribute('data-hcopy-ls'))); });
            });
            container.querySelectorAll('[data-hdelete]').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var i = parseInt(btn.getAttribute('data-hdelete'));
                    var s = _hostedCache[i];
                    if (s) window.dashDeleteHosted(s.hash, i);
                });
            });
            container.querySelectorAll('[data-hedit]').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    var i = parseInt(btn.getAttribute('data-hedit'));
                    var s = _hostedCache[i];
                    if (!s) return;
                    // Load label + content then open edit tab
                    document.getElementById('edit-hosted-hash').value  = s.hash;
                    document.getElementById('edit-hosted-label').value = s.label || '';
                    document.getElementById('edit-hosted-content').value = '-- loading…';
                    document.getElementById('edit-hosted-result').style.display = 'none';
                    switchTab('edit-hosted');
                    const d = await apiAdmin({ action: 'get', hash: s.hash }).catch(() => ({}));
                    document.getElementById('edit-hosted-content').value = d.ok ? (d.content || '') : '-- failed to load';
                });
            });
        }

        window.dashCopyHostedUrl = function(i) {
            const s = _hostedCache[i]; if (!s) return;
            navigator.clipboard.writeText(getScriptUrl(s.hash)).catch(() => {});
            flashBtn(i, 0);
        };
        window.dashCopyHostedLs = function(i) {
            const s = _hostedCache[i]; if (!s) return;
            navigator.clipboard.writeText(getLoadstring(s.hash)).catch(() => {});
            flashBtn(i, 1);
        };
        function flashBtn(i, btnIdx) {
            const row = document.getElementById('hosted-row-' + i);
            if (!row) return;
            const btns = row.querySelectorAll('.dash-icon-btn');
            if (btns[btnIdx]) {
                btns[btnIdx].style.borderColor = 'var(--green)';
                btns[btnIdx].style.color = 'var(--green)';
                setTimeout(() => { btns[btnIdx].style.borderColor = ''; btns[btnIdx].style.color = ''; }, 1000);
            }
        }
        window.dashDeleteHosted = async function(hash, i) {
            if (!confirm('Delete this hosted script? Cannot be undone.')) return;
            const data = await apiAdmin({ action: 'delete', hash }).catch(() => ({}));
            if (data.ok) { renderHostedScripts(); refreshOverview(); }
            else alert('Delete failed: ' + (data.error || 'unknown'));
        };

        // ── Clock ─────────────────────────────────────────────────────────
        function updateClock() {
            const el = document.getElementById('dash-clock');
            if (!el) return;
            const n = new Date();
            el.textContent = String(n.getHours()).padStart(2,'0') + ':' + String(n.getMinutes()).padStart(2,'0') + ':' + String(n.getSeconds()).padStart(2,'0');
        }
        setInterval(updateClock, 1000); updateClock();

        // ── Wire nav/tab buttons ──────────────────────────────────────────
        function wireNavItems() {
            document.querySelectorAll('[data-tab]').forEach(el => {
                const clone = el.cloneNode(true);
                el.parentNode.replaceChild(clone, el);
            });
            document.querySelectorAll('[data-tab]').forEach(el => {
                el.addEventListener('click', function(e) {
                    e.preventDefault();
                    switchTab(this.getAttribute('data-tab'));
                });
            });
        }

        // ── Key System API helper ─────────────────────────────────────────
        async function apiKeys(payload) {
            const r = await fetch('/api/keys', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...payload, password: getPw() }),
            });
            return r.json();
        }

        function getLoaderSnippet(hash) {
            return `-- 1. Paste your key below (replace YOUR-KEY)\nscript_key="YOUR-KEY"\n\n-- 2. Run this line to execute the script\nloadstring(game:HttpGet("https://api.flurs.xyz/files/v3/loader/${hash}.lua", true))()`;
        }

        function getLoaderFile(hash) {
            // The Lua that actually runs when HttpGet hits v3/loader/HASH.lua
            // v3 loader reads the key from X-Flurs-Key header
            return `-- Flurs v3 Loader
-- Do NOT share this URL without a key — it will just return an error.
-- Usage: FLURS_KEY="YOUR-KEY"; loadstring(game:HttpGet("https://api.flurs.xyz/files/v3/loader/${hash}.lua"))()

local key = (getgenv and getgenv().FLURS_KEY) or (genv and genv().FLURS_KEY)
if not key or key == "" then
    error("[Flurs] No key provided. Set FLURS_KEY before running.", 0)
end

local ok_hwid, hwid = pcall(function()
    return game:GetService("RbxAnalyticsService"):GetClientId()
end)

local ok, result = pcall(function()
    return game:HttpGet("https://api.flurs.xyz/files/v3/loader/${hash}.lua", true, {
        ["X-Flurs-Key"]  = key,
        ["X-Flurs-Hwid"] = ok_hwid and hwid or "unknown",
    })
end)

if not ok then error("[Flurs] Could not reach server.", 0) end
if result:sub(1,5) == "error" then loadstring(result)() return end

local fn, err = loadstring(result)
if not fn then error("[Flurs] " .. tostring(err), 0) end
fn()`;
        }

        function statusBadge(key) {
            const now = Date.now();
            if (key.blacklisted) return '<span class="key-badge blacklisted">Blacklisted</span>';
            if (key.revoked)     return '<span class="key-badge revoked">Revoked</span>';
            if (key.expiresAt && now > key.expiresAt) return '<span class="key-badge expired">Expired</span>';
            if (key.maxUses && key.useCount >= key.maxUses) return '<span class="key-badge expired">Max Uses</span>';
            return '<span class="key-badge active">Active</span>';
        }

        function fmtDate(ts) {
            if (!ts) return '—';
            return new Date(ts).toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' });
        }

        // ── Render Key Scripts tab ────────────────────────────────────────
        async function renderKeyScripts() {
            const container = document.getElementById('key-scripts-list');
            if (!container) return;
            container.innerHTML = '<p class="dash-empty">Loading…</p>';
            const data = await apiKeys({ action: 'listscripts' }).catch(() => ({}));
            const scripts = (data.ok && Array.isArray(data.scripts)) ? data.scripts : [];

            const badge = document.getElementById('keyscript-count-badge');
            if (badge) badge.textContent = scripts.length;

            if (!scripts.length) { container.innerHTML = '<p class="dash-empty">No key scripts yet. Upload one using the sidebar.</p>'; return; }

            container.innerHTML = scripts.map(function(s) {
                return '<div class="dash-script-row" id="ks-row-' + s.hash + '">' +
                    '<div class="dash-script-row-left">' +
                    '<div class="dash-script-row-icon" style="background:rgba(245,158,11,0.1);border-color:rgba(245,158,11,0.2);color:#f59e0b;"><i class="fa-solid fa-shield-halved"></i></div>' +
                    '<div class="dash-script-row-info">' +
                    '<div class="dash-script-row-name">' + escHtml(s.label || 'Unnamed') + '</div>' +
                    '<div class="dash-script-row-meta" style="font-family:monospace;font-size:0.7rem;color:var(--muted);">' + escHtml(s.hash) + '</div>' +
                    '</div></div>' +
                    '<div class="dash-script-row-actions">' +
                    '<button class="dash-icon-btn" title="Copy full snippet" data-ks-copy="' + escHtml(s.hash) + '"><i class="fa-solid fa-copy"></i></button>' +
                    '<button class="dash-icon-btn" title="Edit" data-ks-edit="' + escHtml(s.hash) + '" data-ks-label="' + escHtml(s.label||'') + '"><i class="fa-solid fa-pen"></i></button>' +
                    '<button class="dash-icon-btn" title="View loader snippet" data-ks-snippet="' + escHtml(s.hash) + '"><i class="fa-solid fa-code"></i></button>' +
                    '<button class="dash-icon-btn danger" title="Delete" data-ks-delete="' + escHtml(s.hash) + '"><i class="fa-solid fa-trash"></i></button>' +
                    '</div></div>';
            }).join('');

            container.querySelectorAll('[data-ks-copy]').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    navigator.clipboard.writeText(getLoaderSnippet(btn.getAttribute('data-ks-copy'))).catch(()=>{});
                    btn.style.color = 'var(--green)'; setTimeout(()=>{ btn.style.color=''; }, 1000);
                });
            });
            container.querySelectorAll('[data-ks-edit]').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    const hash = btn.getAttribute('data-ks-edit');
                    document.getElementById('ks-edit-hash').value = hash;
                    document.getElementById('ks-label').value = btn.getAttribute('data-ks-label') || '';
                    document.getElementById('ks-content').value = '-- loading…';
                    document.getElementById('ks-result').style.display = 'none';
                    document.getElementById('ks-cancel-btn').style.display = 'inline-flex';
                    document.getElementById('ks-save-btn').innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save Changes';
                    switchTab('add-key-script');
                    const d = await apiKeys({ action: 'getscript', hash }).catch(()=>({}));
                    document.getElementById('ks-content').value = d.ok ? (d.content||'') : '-- failed to load';
                });
            });
            container.querySelectorAll('[data-ks-snippet]').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const hash = btn.getAttribute('data-ks-snippet');
                    document.getElementById('ks-edit-hash').value = hash;
                    document.getElementById('ks-result-hash').textContent = hash;
                    document.getElementById('ks-loader-snippet').textContent = getLoaderSnippet(hash);
                    document.getElementById('ks-result').style.display = 'block';
                    switchTab('add-key-script');
                });
            });
            container.querySelectorAll('[data-ks-delete]').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    if (!confirm('Delete this key script? Any keys using it will stop working.')) return;
                    const data = await apiKeys({ action: 'deletescript', hash: btn.getAttribute('data-ks-delete') }).catch(()=>({}));
                    if (data.ok) renderKeyScripts();
                    else alert('Delete failed: ' + (data.error||'unknown'));
                });
            });
        }

        // ── Render Keys tab ───────────────────────────────────────────────
        let _allKeys = [];
        async function renderKeys(searchVal) {
            const container = document.getElementById('keys-list');
            if (!container) return;
            if (searchVal === undefined) {
                container.innerHTML = '<p class="dash-empty">Loading…</p>';
                const data = await apiKeys({ action: 'list' }).catch(() => ({}));
                _allKeys = (data.ok && Array.isArray(data.keys)) ? data.keys : [];
            }
            const badge = document.getElementById('keys-count-badge');
            if (badge) badge.textContent = _allKeys.length;

            // Populate script select on keys tab too
            const sel = document.getElementById('key-script-select');
            if (sel && sel.options.length <= 1) {
                const sd = await apiKeys({ action: 'listscripts' }).catch(()=>({}));
                const ss = (sd.ok && Array.isArray(sd.scripts)) ? sd.scripts : [];
                ss.forEach(function(s) {
                    const o = document.createElement('option');
                    o.value = s.hash; o.textContent = escHtml(s.label || s.hash.slice(0,8));
                    sel.appendChild(o);
                });
            }

            const q = (searchVal || document.getElementById('key-search')?.value || '').toLowerCase();
            const filtered = q ? _allKeys.filter(k => (k.note||'').toLowerCase().includes(q) || k.key.toLowerCase().includes(q)) : _allKeys;

            if (!filtered.length) { container.innerHTML = '<p class="dash-empty">' + (q ? 'No keys match your search.' : 'No keys yet.') + '</p>'; return; }

            container.innerHTML = filtered.map(function(k) {
                const status = statusBadge(k);
                const expired = k.expiresAt && Date.now() > k.expiresAt;
                const maxed   = k.maxUses && k.useCount >= k.maxUses;
                const inactive = k.revoked || k.blacklisted || expired || maxed;
                return '<div class="key-row' + (inactive ? ' key-row-inactive' : '') + '" id="key-row-' + k.id + '">' +
                    '<div class="key-row-main">' +
                    '<div class="key-row-top">' +
                    '<span class="key-row-value">' + escHtml(k.key) + '</span>' +
                    status +
                    '</div>' +
                    '<div class="key-row-meta">' +
                    '<span title="Note"><i class="fa-solid fa-user" style="color:var(--muted);margin-right:0.3rem;font-size:0.7rem;"></i>' + escHtml(k.note || '—') + '</span>' +
                    '<span title="Uses"><i class="fa-solid fa-chart-simple" style="color:var(--muted);margin-right:0.3rem;font-size:0.7rem;"></i>' + (k.useCount||0) + (k.maxUses ? '/' + k.maxUses : '') + ' uses</span>' +
                    '<span title="HWID"><i class="fa-solid fa-fingerprint" style="color:var(--muted);margin-right:0.3rem;font-size:0.7rem;"></i>' + (k.hwid ? 'Locked' : 'Unlocked') + '</span>' +
                    '<span title="Expires"><i class="fa-solid fa-clock" style="color:var(--muted);margin-right:0.3rem;font-size:0.7rem;"></i>' + (k.expiresAt ? fmtDate(k.expiresAt) : 'Never') + '</span>' +
                    '<span title="Last used"><i class="fa-solid fa-bolt" style="color:var(--muted);margin-right:0.3rem;font-size:0.7rem;"></i>' + (k.lastUsed ? fmtDate(k.lastUsed) : 'Never') + '</span>' +
                    '</div>' +
                    '</div>' +
                    '<div class="key-row-actions">' +
                    '<button class="copy-btn" style="font-size:0.72rem;" data-key-copy="' + escHtml(k.key) + '">Copy</button>' +
                    '<button class="dash-icon-btn" title="' + (k.revoked ? 'Unrevoke' : 'Revoke') + '" data-key-revoke="' + k.id + '" data-key-revoked="' + k.revoked + '"><i class="fa-solid fa-' + (k.revoked ? 'rotate-left' : 'ban') + '"></i></button>' +
                    '<button class="dash-icon-btn" title="Reset HWID" data-key-reset-hwid="' + k.id + '"' + (!k.hwid ? ' disabled style="opacity:0.4;cursor:not-allowed;"' : '') + '><i class="fa-solid fa-fingerprint"></i></button>' +
                    '<button class="dash-icon-btn ' + (k.blacklisted ? 'active-danger' : '') + '" title="' + (k.blacklisted ? 'Unblacklist' : 'Blacklist') + '" data-key-blacklist="' + k.id + '" data-key-bl="' + k.blacklisted + '"><i class="fa-solid fa-skull"></i></button>' +
                    '<button class="dash-icon-btn danger" title="Delete" data-key-delete="' + k.id + '"><i class="fa-solid fa-trash"></i></button>' +
                    '</div>' +
                    '</div>';
            }).join('');

            // Wire buttons
            container.querySelectorAll('[data-key-copy]').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    navigator.clipboard.writeText(btn.getAttribute('data-key-copy')).catch(()=>{});
                    const orig = btn.textContent; btn.textContent = 'Copied!';
                    setTimeout(()=>{ btn.textContent = orig; }, 1200);
                });
            });
            container.querySelectorAll('[data-key-revoke]').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    const id = btn.getAttribute('data-key-revoke');
                    const isRevoked = btn.getAttribute('data-key-revoked') === 'true';
                    const d = await apiKeys({ action: isRevoked ? 'unrevoke' : 'revoke', id }).catch(()=>({}));
                    if (d.ok) { _allKeys = []; renderKeys(); } else alert('Failed: ' + (d.error||'unknown'));
                });
            });
            container.querySelectorAll('[data-key-reset-hwid]').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    if (!confirm('Reset HWID lock? The next device to use this key will become the new locked device.')) return;
                    const d = await apiKeys({ action: 'update', id: btn.getAttribute('data-key-reset-hwid'), resetHwid: true }).catch(()=>({}));
                    if (d.ok) { _allKeys = []; renderKeys(); } else alert('Failed: ' + (d.error||'unknown'));
                });
            });
            container.querySelectorAll('[data-key-blacklist]').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    const id = btn.getAttribute('data-key-blacklist');
                    const isBl = btn.getAttribute('data-key-bl') === 'true';
                    const d = await apiKeys({ action: 'update', id, blacklisted: !isBl }).catch(()=>({}));
                    if (d.ok) { _allKeys = []; renderKeys(); } else alert('Failed: ' + (d.error||'unknown'));
                });
            });
            container.querySelectorAll('[data-key-delete]').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    if (!confirm('Permanently delete this key?')) return;
                    const d = await apiKeys({ action: 'delete', id: btn.getAttribute('data-key-delete') }).catch(()=>({}));
                    if (d.ok) { _allKeys = []; renderKeys(); } else alert('Failed: ' + (d.error||'unknown'));
                });
            });
        }

        // ── Wire key system UI ────────────────────────────────────────────
        function wireKeySystem() {
            // Generate key button
            const createBtn = document.getElementById('key-create-btn');
            if (createBtn) {
                createBtn.addEventListener('click', async function() {
                    const note       = document.getElementById('key-note')?.value.trim() || '';
                    const scriptHash = document.getElementById('key-script-select')?.value || null;
                    const expiryVal  = document.getElementById('key-expiry')?.value;
                    const maxUsesVal = document.getElementById('key-maxuses')?.value;
                    const expiresAt  = expiryVal ? new Date(expiryVal).getTime() : null;
                    const maxUses    = maxUsesVal ? parseInt(maxUsesVal) : null;

                    createBtn.disabled = true;
                    createBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Generating…';

                    const d = await apiKeys({ action: 'create', note, scriptHash, expiresAt, maxUses }).catch(()=>({}));
                    createBtn.disabled = false;
                    createBtn.innerHTML = '<i class="fa-solid fa-key"></i> Generate Key';

                    if (d.ok) {
                        document.getElementById('key-create-value').textContent = d.key;
                        document.getElementById('key-create-result').style.display = 'block';
                        document.getElementById('key-note').value = '';
                        document.getElementById('key-expiry').value = '';
                        document.getElementById('key-maxuses').value = '';
                        _allKeys = []; renderKeys();
                    } else {
                        alert('Failed: ' + (d.error||'unknown'));
                    }
                });
            }

            const keyCopyBtn = document.getElementById('key-copy-btn');
            if (keyCopyBtn) {
                keyCopyBtn.addEventListener('click', function() {
                    const val = document.getElementById('key-create-value')?.textContent;
                    if (val) navigator.clipboard.writeText(val).catch(()=>{});
                    keyCopyBtn.textContent = 'Copied!';
                    setTimeout(()=>{ keyCopyBtn.textContent = 'Copy'; }, 1200);
                });
            }

            // Key search
            const keySearch = document.getElementById('key-search');
            if (keySearch) keySearch.addEventListener('input', function() { renderKeys(keySearch.value); });

            // Keys refresh
            const keysRefresh = document.getElementById('keys-refresh-btn');
            if (keysRefresh) keysRefresh.addEventListener('click', function() { _allKeys = []; renderKeys(); });

            // Upload key script
            const ksSaveBtn   = document.getElementById('ks-save-btn');
            const ksCancelBtn = document.getElementById('ks-cancel-btn');

            if (ksCancelBtn) {
                ksCancelBtn.addEventListener('click', function() {
                    document.getElementById('ks-edit-hash').value = '';
                    document.getElementById('ks-label').value = '';
                    document.getElementById('ks-content').value = '';
                    document.getElementById('ks-result').style.display = 'none';
                    ksCancelBtn.style.display = 'none';
                    ksSaveBtn.innerHTML = '<i class="fa-solid fa-lock"></i> Save Key Script';
                    switchTab('key-scripts');
                });
            }

            if (ksSaveBtn) {
                ksSaveBtn.addEventListener('click', async function() {
                    const hash    = document.getElementById('ks-edit-hash').value || null;
                    const label   = document.getElementById('ks-label').value.trim();
                    const content = document.getElementById('ks-content').value.trim();
                    if (!label)   { alert('Label is required.'); return; }
                    if (!content) { alert('Script content is required.'); return; }

                    ksSaveBtn.disabled = true;
                    ksSaveBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving…';

                    const d = await apiKeys({ action: 'savescript', hash, label, content }).catch(()=>({}));
                    ksSaveBtn.disabled = false;
                    ksSaveBtn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save Changes';

                    if (d.ok) {
                        const finalHash = d.hash;
                        document.getElementById('ks-edit-hash').value = finalHash;
                        document.getElementById('ks-result-hash').textContent = finalHash;
                        document.getElementById('ks-loader-snippet').textContent = getLoaderSnippet(finalHash);
                        document.getElementById('ks-result').style.display = 'block';
                        ksCancelBtn.style.display = 'inline-flex';
                        renderKeyScripts();
                        // Reload key script selects
                        const sel = document.getElementById('key-script-select');
                        if (sel) { sel.innerHTML = '<option value="">— Any key script —</option>'; }
                    } else {
                        alert('Failed: ' + (d.error||'unknown'));
                        ksSaveBtn.innerHTML = '<i class="fa-solid fa-lock"></i> Save Key Script';
                    }
                });
            }

            // Copy loader snippet
            const ksSnippetCopy = document.getElementById('ks-copy-snippet-btn');
            if (ksSnippetCopy) {
                ksSnippetCopy.addEventListener('click', function() {
                    const text = document.getElementById('ks-loader-snippet')?.textContent;
                    if (text) navigator.clipboard.writeText(text).catch(()=>{});
                    ksSnippetCopy.textContent = 'Copied!';
                    setTimeout(()=>{ ksSnippetCopy.textContent = 'Copy'; }, 1200);
                });
            }
        }

        // ── Wire edit forms ───────────────────────────────────────────────
        function wireEditForms() {

            // ── Edit Public Script form ───────────────────────────────────
            const imgInput    = document.getElementById('edit-pub-image');
            const previewWrap = document.getElementById('edit-image-preview-wrap');
            const previewImg  = document.getElementById('edit-pub-image-preview');
            const clearBtn    = document.getElementById('edit-pub-image-clear');

            if (imgInput) {
                imgInput.addEventListener('change', function() {
                    const file = imgInput.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        previewWrap.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                });
            }
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    imgInput.value = '';
                    previewWrap.style.display = 'none';
                    previewImg.src = '';
                });
            }

            const savePublicBtn  = document.getElementById('edit-pub-save-btn');
            const cancelPublicBtn = document.getElementById('edit-pub-cancel-btn');

            if (cancelPublicBtn) {
                cancelPublicBtn.addEventListener('click', function() { switchTab('public-scripts'); });
            }

            if (savePublicBtn) {
                savePublicBtn.addEventListener('click', async function() {
                    const id          = document.getElementById('edit-pub-id').value;
                    const name        = document.getElementById('edit-pub-name').value.trim();
                    const tags        = document.getElementById('edit-pub-tags').value.split(',').map(t => t.trim()).filter(Boolean);
                    const description = document.getElementById('edit-pub-description').value.trim();
                    const loadstring  = document.getElementById('edit-pub-loadstring').value.trim();
                    if (!name || !loadstring) { alert('Name and loadstring are required.'); return; }

                    savePublicBtn.disabled = true;
                    savePublicBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving…';

                    let imageBase64 = null, imageType = null;
                    if (imgInput && imgInput.files && imgInput.files[0]) {
                        const file = imgInput.files[0];
                        imageType = file.type;
                        imageBase64 = await new Promise(function(resolve) {
                            const r = new FileReader();
                            r.onload = function() { resolve(r.result.split(',')[1]); };
                            r.readAsDataURL(file);
                        });
                    }

                    const payload = { action: 'update', password: getPw(), id, name, description, loadstring, tags };
                    if (imageBase64) { payload.imageBase64 = imageBase64; payload.imageType = imageType; }

                    const data = await apiUploadscript(payload).catch(() => ({}));
                    savePublicBtn.disabled = false;
                    savePublicBtn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save Changes';

                    if (data.ok) {
                        const resultEl = document.getElementById('edit-pub-result');
                        resultEl.style.display = 'flex';
                        setTimeout(function() { resultEl.style.display = 'none'; switchTab('public-scripts'); }, 1800);
                        renderPublicScripts();
                        refreshOverview();
                    } else {
                        alert('Update failed: ' + (data.error || 'unknown'));
                    }
                });
            }

            // ── Edit Hosted Script form ───────────────────────────────────
            const saveHostedBtn   = document.getElementById('edit-hosted-save-btn');
            const cancelHostedBtn = document.getElementById('edit-hosted-cancel-btn');

            if (cancelHostedBtn) {
                cancelHostedBtn.addEventListener('click', function() { switchTab('host-scripts'); });
            }

            if (saveHostedBtn) {
                saveHostedBtn.addEventListener('click', async function() {
                    const hash    = document.getElementById('edit-hosted-hash').value;
                    const label   = document.getElementById('edit-hosted-label').value.trim();
                    const content = document.getElementById('edit-hosted-content').value;
                    if (!hash)    { alert('No script selected.'); return; }
                    if (!label)   { alert('Label cannot be empty.'); return; }
                    if (!content) { alert('Content cannot be empty.'); return; }

                    saveHostedBtn.disabled = true;
                    saveHostedBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving…';

                    const data = await apiAdmin({ action: 'save', hash, label, content }).catch(() => ({}));
                    saveHostedBtn.disabled = false;
                    saveHostedBtn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save Changes';

                    if (data.ok) {
                        const resultEl = document.getElementById('edit-hosted-result');
                        resultEl.style.display = 'flex';
                        setTimeout(function() { resultEl.style.display = 'none'; switchTab('host-scripts'); }, 1800);
                        renderHostedScripts();
                    } else {
                        alert('Save failed: ' + (data.error || 'unknown'));
                    }
                });
            }
        }

        // ── Called once script.js unlocks the panel ───────────────────────
        function onDashboardUnlocked() {
            const gate  = document.getElementById('admin-gate');
            const panel = document.getElementById('admin-panel');
            const sb    = document.querySelector('.dash-sidebar');
            if (gate)  gate.style.display = 'none';
            if (panel) { panel.style.display = 'flex'; panel.style.flexDirection = 'row'; }
            if (sb)    sb.style.display = 'flex';

            // Remove script.js injected logout btn — we have our own
            const oldLogout = document.getElementById('admin-logout-btn');
            if (oldLogout) oldLogout.remove();

            wireNavItems();
            wireEditForms();
            wireKeySystem();
            refreshOverview();
        }

        // ── Logout ────────────────────────────────────────────────────────
        function wireOurLogout() {
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#dash-logout-btn')) return;
                localStorage.removeItem('flurs_admin_pw');
                const gate  = document.getElementById('admin-gate');
                const panel = document.getElementById('admin-panel');
                const sb    = document.querySelector('.dash-sidebar');
                if (gate)  gate.style.display = 'flex';
                if (panel) panel.style.display = 'none';
                if (sb)    sb.style.display = 'none';
                const pwInput = document.getElementById('admin-password-input');
                if (pwInput) pwInput.value = '';
            });
        }

        // ── Watch for script.js unlocking the panel ───────────────────────
        function watchForUnlock() {
            const panel = document.getElementById('admin-panel');
            if (!panel) return;
            let alreadyFired = false;
            const observer = new MutationObserver(function() {
                const vis = panel.style.display && panel.style.display !== 'none';
                if (vis && !alreadyFired) { alreadyFired = true; onDashboardUnlocked(); }
            });
            observer.observe(panel, { attributes: true, attributeFilter: ['style'] });
        }

        // ── Init ──────────────────────────────────────────────────────────
        function init() {
            wireOurLogout();
            wireNavItems();
            watchForUnlock();

            const sb   = document.querySelector('.dash-sidebar');
            const gate = document.getElementById('admin-gate');
            if (sb)   sb.style.display = 'none';
            if (gate) gate.style.display = 'flex';

            // If already auto-unlocked from saved password
            const panel = document.getElementById('admin-panel');
            if (panel && panel.style.display && panel.style.display !== 'none') {
                onDashboardUnlocked();
            }

            if (window.location.hash === '#uploadscript') {
                history.replaceState(null, '', '#admin');
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else { setTimeout(init, 0); }

    })();
    </script>

    <script>
    /* ── MOBILE MENU ──────────────────────────────────────────────────────── */
    (function() {
        const burgerBtn  = document.getElementById('burger-btn');
        const closeBtn   = document.getElementById('mobile-menu-close');
        const overlay    = document.getElementById('mobile-menu-overlay');
        const menu       = document.getElementById('mobile-menu');
        const mobileLinks = document.querySelectorAll('.mobile-nav-link');

        function openMenu() {
            menu.classList.add('open');
            overlay.classList.add('open');
            burgerBtn.classList.add('open');
            burgerBtn.setAttribute('aria-expanded', 'true');
            document.body.style.overflow = 'hidden';
        }
        function closeMenu() {
            menu.classList.remove('open');
            overlay.classList.remove('open');
            burgerBtn.classList.remove('open');
            burgerBtn.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
        }

        if (burgerBtn) burgerBtn.addEventListener('click', openMenu);
        if (closeBtn)  closeBtn.addEventListener('click', closeMenu);
        if (overlay)   overlay.addEventListener('click', closeMenu);

        mobileLinks.forEach(function(link) {
            link.addEventListener('click', function() {
                // Sync active state with desktop nav
                mobileLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                const page = link.getAttribute('data-page');
                if (page) {
                    document.querySelectorAll('.nav-link').forEach(l => {
                        l.classList.toggle('active', l.getAttribute('data-page') === page);
                    });
                }
                closeMenu();
            });
        });

        // Sync mobile active state when desktop nav changes
        document.querySelectorAll('.nav-link').forEach(function(link) {
            link.addEventListener('click', function() {
                const page = link.getAttribute('data-page');
                mobileLinks.forEach(l => {
                    l.classList.toggle('active', l.getAttribute('data-page') === page);
                });
            });
        });

        // Wire mobile social buttons to same targets as desktop
        const discordBtn = document.getElementById('download-btn');
        const tiktokBtn  = document.getElementById('tiktok-btn');
        const mobileDiscord = document.getElementById('mobile-discord-btn');
        const mobileTiktok  = document.getElementById('mobile-tiktok-btn');
        if (mobileDiscord && discordBtn) {
            mobileDiscord.addEventListener('click', function(e) {
                e.preventDefault(); closeMenu();
                discordBtn.click();
            });
        }
        if (mobileTiktok && tiktokBtn) {
            mobileTiktok.addEventListener('click', function(e) {
                e.preventDefault(); closeMenu();
                tiktokBtn.click();
            });
        }
    })();
    </script>

</body>
</html>